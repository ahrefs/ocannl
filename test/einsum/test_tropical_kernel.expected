Retrieving commandline, environment, or config file variable ocannl_log_level
Found 0, in the config file
Testing tropical conv with learnable kernel (forward)...
Input shape: 4x4x1 (values 0-15)
Kernel shape: 2x2 (values [[0,1],[2,3]])
Stride: 2, Window: 2x2
Output formula: max over (wh,ww) of (input[2*oh+wh, 2*ow+ww] + kernel[wh,ww])

Expected output calculations:
  [0,0]: max(0+0, 1+1, 4+2, 5+3) = max(0, 2, 6, 8) = 8
  [0,1]: max(2+0, 3+1, 6+2, 7+3) = max(2, 4, 8, 10) = 10
  [1,0]: max(8+0, 9+1, 12+2, 13+3) = max(8, 10, 14, 16) = 16
  [1,1]: max(10+0, 11+1, 14+2, 15+3) = max(10, 12, 16, 18) = 18

HERE: test/einsum/test_tropical_kernel.ml:76:21
┌──────────────────────────────┐
│[0]: r4x4x1 shape 0:4,1:4,2:1 │
│┌──────┬─────────┐            │
││      │axis 2   │            │
│├──────┼─────────┤            │
││0 @ 0 │ 0.00    │            │
││axis 1│ 1.00    │            │
││      │ 2.00    │            │
││      │ 3.00    │            │
│├──────┼─────────┤            │
││1 @ 0 │ 4.00    │            │
││axis 1│ 5.00    │            │
││      │ 6.00    │            │
││      │ 7.00    │            │
│├──────┼─────────┤            │
││2 @ 0 │ 8.00    │            │
││axis 1│ 9.00    │            │
││      │ 1.00e+1 │            │
││      │ 1.10e+1 │            │
│├──────┼─────────┤            │
││3 @ 0 │ 1.20e+1 │            │
││axis 1│ 1.30e+1 │            │
││      │ 1.40e+1 │            │
││      │ 1.50e+1 │            │
│└──────┴─────────┘            │
└──────────────────────────────┘
HERE: test/einsum/test_tropical_kernel.ml:77:21
┌─────────────────────┐
│[1]: k shape 0:2,1:2 │
│┌──────┬────────────┐│
││      │axis 1      ││
│├──────┼────────────┤│
││axis 0│ 0.00  1.00 ││
││      │ 2.00  3.00 ││
│└──────┴────────────┘│
└─────────────────────┘
HERE: test/einsum/test_tropical_kernel.ml:78:21
┌─────────────────────────────────────────┐
│[7]: @^=>+_op_r4x4x1_k shape 0:2,1:2,2:1 │
│┌──────┬─────────┐                       │
││      │axis 2   │                       │
│├──────┼─────────┤                       │
││0 @ 0 │ 8.00    │                       │
││axis 1│ 1.00e+1 │                       │
│├──────┼─────────┤                       │
││1 @ 0 │ 1.60e+1 │                       │
││axis 1│ 1.80e+1 │                       │
│└──────┴─────────┘                       │
└─────────────────────────────────────────┘

Testing tropical conv backprop with zero kernel...
Input shape: 4x4x1
Kernel shape: 2x2 (all zeros)
Stride: 2, Window: 2x2
Expected output: [[9, 8], [7, 6]]
Expected loss: 9 + 8 + 7 + 6 = 30

Expected input gradients: 1 at argmax positions, 0 elsewhere
Kernel gradients (LIMITATION): all 4s due to cond_lhs always being true

HERE: test/einsum/test_tropical_kernel.ml:148:21
┌────────────────────────┐
│[12]: =>_loss shape 0:1 │
│┌┬─────────┐            │
│││axis 0   │            │
│├┼─────────┤            │
│││ 3.00e+1 │            │
│└┴─────────┘            │
└────────────────────────┘
grad_=>_loss <not-hosted>
HERE: test/einsum/test_tropical_kernel.ml:149:21
┌─────────────────────────┐
│[0]: x shape 0:4,1:4,2:1 │
│┌──────┬──────┐          │
││      │axis 2│          │
│├──────┼──────┤          │
││0 @ 0 │ 9.00 │          │
││axis 1│ 0.00 │          │
││      │ 0.00 │          │
││      │ 0.00 │          │
│├──────┼──────┤          │
││1 @ 0 │ 0.00 │          │
││axis 1│ 0.00 │          │
││      │ 0.00 │          │
││      │ 8.00 │          │
│├──────┼──────┤          │
││2 @ 0 │ 0.00 │          │
││axis 1│ 7.00 │          │
││      │ 0.00 │          │
││      │ 0.00 │          │
│├──────┼──────┤          │
││3 @ 0 │ 0.00 │          │
││axis 1│ 0.00 │          │
││      │ 6.00 │          │
││      │ 0.00 │          │
│└──────┴──────┘          │
└─────────────────────────┘
┌────────────────────────────────┐
│[0]: x shape 0:4,1:4,2:1  grad_x│
│┌──────┬──────┐                 │
││      │axis 2│                 │
│├──────┼──────┤                 │
││0 @ 0 │ 1.00 │                 │
││axis 1│ 0.00 │                 │
││      │ 0.00 │                 │
││      │ 0.00 │                 │
│├──────┼──────┤                 │
││1 @ 0 │ 0.00 │                 │
││axis 1│ 0.00 │                 │
││      │ 0.00 │                 │
││      │ 1.00 │                 │
│├──────┼──────┤                 │
││2 @ 0 │ 0.00 │                 │
││axis 1│ 1.00 │                 │
││      │ 0.00 │                 │
││      │ 0.00 │                 │
│├──────┼──────┤                 │
││3 @ 0 │ 0.00 │                 │
││axis 1│ 0.00 │                 │
││      │ 1.00 │                 │
││      │ 0.00 │                 │
│└──────┴──────┘                 │
└────────────────────────────────┘
HERE: test/einsum/test_tropical_kernel.ml:150:21
┌─────────────────────┐
│[2]: k shape 0:2,1:2 │
│┌──────┬────────────┐│
││      │axis 1      ││
│├──────┼────────────┤│
││axis 0│ 0.00  0.00 ││
││      │ 0.00  0.00 ││
│└──────┴────────────┘│
└─────────────────────┘
┌────────────────────────────┐
│[2]: k shape 0:2,1:2  grad_k│
│┌──────┬────────────┐       │
││      │axis 1      │       │
│├──────┼────────────┤       │
││axis 0│ 4.00  4.00 │       │
││      │ 4.00  4.00 │       │
│└──────┴────────────┘       │
└────────────────────────────┘

Testing tropical conv backprop with non-zero kernel...
Input shape: 4x4x1 (all 1s)
Kernel shape: 2x2 ([[0,0],[0,10]])
Stride: 2, Window: 2x2
Expected output: all 11 (1 + 10 at kernel position (1,1))
Expected loss: 11 * 4 = 44

Expected input gradients:
  1 at positions (1,1), (1,3), (3,1), (3,3) - these correspond to kernel[1,1]
  0 elsewhere
Kernel gradients (LIMITATION): all 4s (should be [[0,0],[0,4]])

HERE: test/einsum/test_tropical_kernel.ml:219:21
┌────────────────────────┐
│[12]: =>_loss shape 0:1 │
│┌┬─────────┐            │
│││axis 0   │            │
│├┼─────────┤            │
│││ 4.40e+1 │            │
│└┴─────────┘            │
└────────────────────────┘
grad_=>_loss <not-hosted>
HERE: test/einsum/test_tropical_kernel.ml:220:21
┌─────────────────────────┐
│[0]: x shape 0:4,1:4,2:1 │
│┌──────┬──────┐          │
││      │axis 2│          │
│├──────┼──────┤          │
││0 @ 0 │ 1.00 │          │
││axis 1│ 1.00 │          │
││      │ 1.00 │          │
││      │ 1.00 │          │
│├──────┼──────┤          │
││1 @ 0 │ 1.00 │          │
││axis 1│ 1.00 │          │
││      │ 1.00 │          │
││      │ 1.00 │          │
│├──────┼──────┤          │
││2 @ 0 │ 1.00 │          │
││axis 1│ 1.00 │          │
││      │ 1.00 │          │
││      │ 1.00 │          │
│├──────┼──────┤          │
││3 @ 0 │ 1.00 │          │
││axis 1│ 1.00 │          │
││      │ 1.00 │          │
││      │ 1.00 │          │
│└──────┴──────┘          │
└─────────────────────────┘
┌────────────────────────────────┐
│[0]: x shape 0:4,1:4,2:1  grad_x│
│┌──────┬──────┐                 │
││      │axis 2│                 │
│├──────┼──────┤                 │
││0 @ 0 │ 0.00 │                 │
││axis 1│ 0.00 │                 │
││      │ 0.00 │                 │
││      │ 0.00 │                 │
│├──────┼──────┤                 │
││1 @ 0 │ 0.00 │                 │
││axis 1│ 1.00 │                 │
││      │ 0.00 │                 │
││      │ 1.00 │                 │
│├──────┼──────┤                 │
││2 @ 0 │ 0.00 │                 │
││axis 1│ 0.00 │                 │
││      │ 0.00 │                 │
││      │ 0.00 │                 │
│├──────┼──────┤                 │
││3 @ 0 │ 0.00 │                 │
││axis 1│ 1.00 │                 │
││      │ 0.00 │                 │
││      │ 1.00 │                 │
│└──────┴──────┘                 │
└────────────────────────────────┘
HERE: test/einsum/test_tropical_kernel.ml:221:21
┌────────────────────────┐
│[2]: k shape 0:2,1:2    │
│┌──────┬───────────────┐│
││      │axis 1         ││
│├──────┼───────────────┤│
││axis 0│ 0.00  0.00    ││
││      │ 0.00  1.00e+1 ││
│└──────┴───────────────┘│
└────────────────────────┘
┌────────────────────────────┐
│[2]: k shape 0:2,1:2  grad_k│
│┌──────┬────────────┐       │
││      │axis 1      │       │
│├──────┼────────────┤       │
││axis 0│ 4.00  4.00 │       │
││      │ 4.00  4.00 │       │
│└──────┴────────────┘       │
└────────────────────────────┘


All tropical kernel tests completed!
