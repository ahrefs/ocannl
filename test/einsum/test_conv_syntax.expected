Testing conv syntax parsing...
Test 1: Parsed '2*o+3*k' successfully
  Structure: ((bcast_batch ()) (bcast_input ()) (bcast_output ()) (given_batch ())
 (given_input ())
 (given_output
  ((Affine_spec (stride 2) (over_label o)
    (conv (((dilation 3) (kernel_label k) (use_padding Unspecified))))
    (stride_offset 0))))
 (given_beg_batch ()) (given_beg_input ()) (given_beg_output ())
 (labels
  ((((in_axes Output) (pos 1) (from_end true))
    (Affine_spec (stride 2) (over_label o)
     (conv (((dilation 3) (kernel_label k) (use_padding Unspecified))))
     (stride_offset 0))))))

Test 2: Parsed 'o+k' successfully
  Structure: ((bcast_batch ()) (bcast_input ()) (bcast_output ()) (given_batch ())
 (given_input ())
 (given_output
  ((Affine_spec (stride 1) (over_label o)
    (conv (((dilation 1) (kernel_label k) (use_padding Unspecified))))
    (stride_offset 0))))
 (given_beg_batch ()) (given_beg_input ()) (given_beg_output ())
 (labels
  ((((in_axes Output) (pos 1) (from_end true))
    (Affine_spec (stride 1) (over_label o)
     (conv (((dilation 1) (kernel_label k) (use_padding Unspecified))))
     (stride_offset 0))))))

Test 3: Parsed 'a, 2*b+c' successfully
  Structure: ((bcast_batch ()) (bcast_input ()) (bcast_output ()) (given_batch ())
 (given_input ())
 (given_output
  ((Label a)
   (Affine_spec (stride 2) (over_label b)
    (conv (((dilation 1) (kernel_label c) (use_padding Unspecified))))
    (stride_offset 0))))
 (given_beg_batch ()) (given_beg_input ()) (given_beg_output ())
 (labels
  ((((in_axes Output) (pos 1) (from_end true))
    (Affine_spec (stride 2) (over_label b)
     (conv (((dilation 1) (kernel_label c) (use_padding Unspecified))))
     (stride_offset 0)))
   (((in_axes Output) (pos 2) (from_end true)) (Label a)))))

Test 4: Parsed 'i, o+k, j' successfully (multichar mode)
  Structure: ((bcast_batch ()) (bcast_input ()) (bcast_output ()) (given_batch ())
 (given_input ())
 (given_output
  ((Label i)
   (Affine_spec (stride 1) (over_label o)
    (conv (((dilation 1) (kernel_label k) (use_padding Unspecified))))
    (stride_offset 0))
   (Label j)))
 (given_beg_batch ()) (given_beg_input ()) (given_beg_output ())
 (labels
  ((((in_axes Output) (pos 1) (from_end true)) (Label j))
   (((in_axes Output) (pos 2) (from_end true))
    (Affine_spec (stride 1) (over_label o)
     (conv (((dilation 1) (kernel_label k) (use_padding Unspecified))))
     (stride_offset 0)))
   (((in_axes Output) (pos 3) (from_end true)) (Label i)))))

Test 5: Parsed 'a+bc' successfully (multichar mode)
  Structure: ((bcast_batch ()) (bcast_input ()) (bcast_output ()) (given_batch ())
 (given_input ())
 (given_output
  ((Affine_spec (stride 1) (over_label a)
    (conv (((dilation 1) (kernel_label bc) (use_padding Unspecified))))
    (stride_offset 0))))
 (given_beg_batch ()) (given_beg_input ()) (given_beg_output ())
 (labels
  ((((in_axes Output) (pos 1) (from_end true))
    (Affine_spec (stride 1) (over_label a)
     (conv (((dilation 1) (kernel_label bc) (use_padding Unspecified))))
     (stride_offset 0))))))

Test 6: Parsed 'i, j -> 2*i+j' successfully
  Structure: ((bcast_batch ()) (bcast_input ()) (bcast_output ()) (given_batch ())
 (given_input ((Label i) (Label j)))
 (given_output
  ((Affine_spec (stride 2) (over_label i)
    (conv (((dilation 1) (kernel_label j) (use_padding Unspecified))))
    (stride_offset 0))))
 (given_beg_batch ()) (given_beg_input ()) (given_beg_output ())
 (labels
  ((((in_axes Output) (pos 1) (from_end true))
    (Affine_spec (stride 2) (over_label i)
     (conv (((dilation 1) (kernel_label j) (use_padding Unspecified))))
     (stride_offset 0)))
   (((in_axes Input) (pos 1) (from_end true)) (Label j))
   (((in_axes Input) (pos 2) (from_end true)) (Label i)))))

Test 7: Parsed 'batch|input->3*output+1*kernel,' successfully
  Structure: ((bcast_batch ()) (bcast_input ()) (bcast_output ())
 (given_batch ((Label batch))) (given_input ((Label input)))
 (given_output
  ((Affine_spec (stride 3) (over_label output)
    (conv (((dilation 1) (kernel_label kernel) (use_padding Unspecified))))
    (stride_offset 0))))
 (given_beg_batch ()) (given_beg_input ()) (given_beg_output ())
 (labels
  ((((in_axes Batch) (pos 1) (from_end true)) (Label batch))
   (((in_axes Output) (pos 1) (from_end true))
    (Affine_spec (stride 3) (over_label output)
     (conv (((dilation 1) (kernel_label kernel) (use_padding Unspecified))))
     (stride_offset 0)))
   (((in_axes Input) (pos 1) (from_end true)) (Label input)))))

All conv syntax parsing tests passed!

Testing strided iteration syntax parsing...
Test 1: Parsed strided iteration '2*output' successfully
  Structure: ((bcast_batch ()) (bcast_input ()) (bcast_output ()) (given_batch ())
 (given_input ())
 (given_output
  ((Affine_spec (stride 2) (over_label output) (conv ()) (stride_offset 0))))
 (given_beg_batch ()) (given_beg_input ()) (given_beg_output ())
 (labels
  ((((in_axes Output) (pos 1) (from_end true))
    (Affine_spec (stride 2) (over_label output) (conv ()) (stride_offset 0))))))

Test 2: Parsed strided iteration '3*i' successfully
  Structure: ((bcast_batch ()) (bcast_input ()) (bcast_output ()) (given_batch ())
 (given_input ())
 (given_output
  ((Affine_spec (stride 3) (over_label i) (conv ()) (stride_offset 0))))
 (given_beg_batch ()) (given_beg_input ()) (given_beg_output ())
 (labels
  ((((in_axes Output) (pos 1) (from_end true))
    (Affine_spec (stride 3) (over_label i) (conv ()) (stride_offset 0))))))

Test 3: Parsed einsum with strided iteration 'input -> 2*output' successfully
  Structure: ((bcast_batch ()) (bcast_input ()) (bcast_output ()) (given_batch ())
 (given_input ((Label input)))
 (given_output
  ((Affine_spec (stride 2) (over_label output) (conv ()) (stride_offset 0))))
 (given_beg_batch ()) (given_beg_input ()) (given_beg_output ())
 (labels
  ((((in_axes Output) (pos 1) (from_end true))
    (Affine_spec (stride 2) (over_label output) (conv ()) (stride_offset 0)))
   (((in_axes Input) (pos 1) (from_end true)) (Label input)))))

Test 4: Parsed mixed labels with strided iteration 'regular, 3*strided' successfully
  Structure: ((bcast_batch ()) (bcast_input ()) (bcast_output ()) (given_batch ())
 (given_input ())
 (given_output
  ((Label regular)
   (Affine_spec (stride 3) (over_label strided) (conv ()) (stride_offset 0))))
 (given_beg_batch ()) (given_beg_input ()) (given_beg_output ())
 (labels
  ((((in_axes Output) (pos 1) (from_end true))
    (Affine_spec (stride 3) (over_label strided) (conv ()) (stride_offset 0)))
   (((in_axes Output) (pos 2) (from_end true)) (Label regular)))))


All strided iteration parsing tests completed!

Testing multichar mode detection...
✓ Multichar spec 'a,b' parsed correctly
✓ Multichar spec '2*o+k' parsed correctly
✓ Multichar spec 'o+k' parsed correctly
✓ Multichar spec 'a,2*b+c' parsed correctly
✓ Single-char spec 'abc' parsed correctly
✓ Single-char spec 'ijk' parsed correctly
✓ Single-char spec 'i->j' parsed correctly
✓ Single-char spec '...|ij' parsed correctly
✓ Single-char spec 'j...' parsed correctly
✓ Single-char spec '...|j...->i' parsed correctly
✓ Single-char spec '...|i->1' parsed correctly

Testing conv spec parsing...
Conv spec 'a+b': ((bcast_batch ()) (bcast_input ()) (bcast_output ()) (given_batch ())
 (given_input ())
 (given_output
  ((Affine_spec (stride 1) (over_label a)
    (conv (((dilation 1) (kernel_label b) (use_padding Unspecified))))
    (stride_offset 0))))
 (given_beg_batch ()) (given_beg_input ()) (given_beg_output ())
 (labels
  ((((in_axes Output) (pos 1) (from_end true))
    (Affine_spec (stride 1) (over_label a)
     (conv (((dilation 1) (kernel_label b) (use_padding Unspecified))))
     (stride_offset 0))))))
Note: Conv expressions with + or * now always use multichar mode

Testing use_padding syntax (= for true, < for false)...
Test 1: Parsed 'o=+k' (use_padding=true)
  Structure: ((bcast_batch ()) (bcast_input ()) (bcast_output ()) (given_batch ())
 (given_input ())
 (given_output
  ((Affine_spec (stride 1) (over_label o)
    (conv (((dilation 1) (kernel_label k) (use_padding True))))
    (stride_offset 0))))
 (given_beg_batch ()) (given_beg_input ()) (given_beg_output ())
 (labels
  ((((in_axes Output) (pos 1) (from_end true))
    (Affine_spec (stride 1) (over_label o)
     (conv (((dilation 1) (kernel_label k) (use_padding True))))
     (stride_offset 0))))))

Test 2: Parsed 'o<+k' (use_padding=false)
  Structure: ((bcast_batch ()) (bcast_input ()) (bcast_output ()) (given_batch ())
 (given_input ())
 (given_output
  ((Affine_spec (stride 1) (over_label o)
    (conv (((dilation 1) (kernel_label k) (use_padding False))))
    (stride_offset 0))))
 (given_beg_batch ()) (given_beg_input ()) (given_beg_output ())
 (labels
  ((((in_axes Output) (pos 1) (from_end true))
    (Affine_spec (stride 1) (over_label o)
     (conv (((dilation 1) (kernel_label k) (use_padding False))))
     (stride_offset 0))))))

Test 3: Parsed '2*o=+k' (stride with use_padding=true)
  Structure: ((bcast_batch ()) (bcast_input ()) (bcast_output ()) (given_batch ())
 (given_input ())
 (given_output
  ((Affine_spec (stride 2) (over_label o)
    (conv (((dilation 1) (kernel_label k) (use_padding True))))
    (stride_offset 0))))
 (given_beg_batch ()) (given_beg_input ()) (given_beg_output ())
 (labels
  ((((in_axes Output) (pos 1) (from_end true))
    (Affine_spec (stride 2) (over_label o)
     (conv (((dilation 1) (kernel_label k) (use_padding True))))
     (stride_offset 0))))))

Test 4: Parsed 'o<+3*k' (dilation with use_padding=false)
  Structure: ((bcast_batch ()) (bcast_input ()) (bcast_output ()) (given_batch ())
 (given_input ())
 (given_output
  ((Affine_spec (stride 1) (over_label o)
    (conv (((dilation 3) (kernel_label k) (use_padding False))))
    (stride_offset 0))))
 (given_beg_batch ()) (given_beg_input ()) (given_beg_output ())
 (labels
  ((((in_axes Output) (pos 1) (from_end true))
    (Affine_spec (stride 1) (over_label o)
     (conv (((dilation 3) (kernel_label k) (use_padding False))))
     (stride_offset 0))))))

Test 5: Parsed '2*o=+3*k' (stride, dilation, use_padding=true)
  Structure: ((bcast_batch ()) (bcast_input ()) (bcast_output ()) (given_batch ())
 (given_input ())
 (given_output
  ((Affine_spec (stride 2) (over_label o)
    (conv (((dilation 3) (kernel_label k) (use_padding True))))
    (stride_offset 0))))
 (given_beg_batch ()) (given_beg_input ()) (given_beg_output ())
 (labels
  ((((in_axes Output) (pos 1) (from_end true))
    (Affine_spec (stride 2) (over_label o)
     (conv (((dilation 3) (kernel_label k) (use_padding True))))
     (stride_offset 0))))))

Test 6: Parsed 'o+k' (unspecified use_padding)
  Structure: ((bcast_batch ()) (bcast_input ()) (bcast_output ()) (given_batch ())
 (given_input ())
 (given_output
  ((Affine_spec (stride 1) (over_label o)
    (conv (((dilation 1) (kernel_label k) (use_padding Unspecified))))
    (stride_offset 0))))
 (given_beg_batch ()) (given_beg_input ()) (given_beg_output ())
 (labels
  ((((in_axes Output) (pos 1) (from_end true))
    (Affine_spec (stride 1) (over_label o)
     (conv (((dilation 1) (kernel_label k) (use_padding Unspecified))))
     (stride_offset 0))))))

All use_padding syntax tests completed!

All conv syntax tests completed!
