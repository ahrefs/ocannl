open Base
open Ocannl
module Tn = Arrayjit.Tnode
module IDX = Train.IDX
module CDSL = Train.CDSL
module TDSL = Operation.TDSL
module Rand = Arrayjit.Rand.Lib

module type Backend = Arrayjit.Backend_intf.Backend

let%expect_test "Hello World" =
  Tensor.unsafe_reinitialize ();
  Stdio.printf "Hello World!\n";
  [%expect {| Hello World! |}]

let%expect_test "Pointwise multiplication dims 1" =
  Tensor.unsafe_reinitialize ();
  let module Backend = (val Arrayjit.Backends.fresh_backend ()) in
  let backend =
    (module Backend : Backend
      with type buffer_ptr = Backend.buffer_ptr
       and type dev = Backend.dev
       and type runner = Backend.runner
       and type event = Backend.event)
  in
  let stream = Backend.(new_stream @@ get_device ~ordinal:0) in
  let ctx = Backend.make_context stream in
  Rand.init 0;
  (* "Hey" is inferred to be a scalar. *)
  let%op y = 2 *. "hey" 7.0 in
  Train.forward_and_forget backend ctx y;

  Tensor.print ~with_code:false ~with_grad:false `Default @@ y;
  [%expect
    {|
    ┌────────────────────┐
    │[3]: *._y shape 0:1 │
    │┌┬──────────────┐   │
    │││axis 0        │   │
    │├┼──────────────┤   │
    │││ 1.4000000e+1 │   │
    │└┴──────────────┘   │
    └────────────────────┘
    |}]

let%expect_test "Matrix multiplication dims 1x1" =
  Tensor.unsafe_reinitialize ();
  let module Backend = (val Arrayjit.Backends.fresh_backend ()) in
  let backend =
    (module Backend : Backend
      with type buffer_ptr = Backend.buffer_ptr
       and type dev = Backend.dev
       and type runner = Backend.runner
       and type event = Backend.event)
  in
  let stream = Backend.(new_stream @@ get_device ~ordinal:0) in
  let ctx = Backend.make_context stream in
  Rand.init 0;
  (* Hey is inferred to be a matrix because of matrix multiplication [*]. *)
  let%op y = ("hey" 7.0 * 'q' 2.0) + 'p' 1.0 in
  Train.forward_and_forget backend ctx y;
  (* Punning for ["hey"] above introduced the [hey] identifier. *)
  Tensor.print ~with_code:false ~with_grad:false `Default @@ hey;
  [%expect
    {|
    ┌────────────────────────┐
    │[0]: hey shape 1:1->0:1 │
    │┌──────┬───────────┐    │
    ││      │axis 1     │    │
    │├──────┼───────────┤    │
    ││axis 0│ 7.0000000 │    │
    │└──────┴───────────┘    │
    └────────────────────────┘
    |}];
  Tensor.print ~with_code:false ~with_grad:false `Default @@ y;
  [%expect
    {|
    ┌───────────────────┐
    │[6]: +_y shape 0:1 │
    │┌┬──────────────┐  │
    │││axis 0        │  │
    │├┼──────────────┤  │
    │││ 1.5000000e+1 │  │
    │└┴──────────────┘  │
    └───────────────────┘
    |}]

let%expect_test "Print constant tensor" =
  Tensor.unsafe_reinitialize ();
  let module Backend = (val Arrayjit.Backends.fresh_backend ()) in
  let backend =
    (module Backend : Backend
      with type buffer_ptr = Backend.buffer_ptr
       and type dev = Backend.dev
       and type runner = Backend.runner
       and type event = Backend.event)
  in
  let stream = Backend.(new_stream @@ get_device ~ordinal:0) in
  let ctx = Backend.make_context stream in
  Rand.init 0;

  let%op hey = [ (1, 2, 3); (4, 5, 6) ] in
  Train.forward_and_forget backend ctx hey;
  Tensor.print ~with_code:false ~with_grad:false `Inline @@ hey;
  [%expect {| [1.0000000, 2.0000000, 3.0000000; 4.0000000, 5.0000000, 6.0000000] |}];
  Tensor.print ~with_code:false ~with_grad:false `Default @@ hey;
  [%expect
    {|
    ┌──────────────────────────────────────────┐
    │[0]: c2x3_hey shape 1:3->0:2              │
    │┌──────┬─────────────────────────────────┐│
    ││      │axis 1                           ││
    │├──────┼─────────────────────────────────┤│
    ││axis 0│ 1.0000000  2.0000000  3.0000000 ││
    ││      │ 4.0000000  5.0000000  6.0000000 ││
    │└──────┴─────────────────────────────────┘│
    └──────────────────────────────────────────┘
    |}];
  let%op hoo = [| [ 1; 2; 3 ]; [ 4; 5; 6 ] |] in
  Train.forward_and_forget backend ctx hoo;
  Tensor.print ~with_code:false ~with_grad:false `Inline @@ hoo;
  [%expect {| [|[1.0000000; 2.0000000; 3.0000000]; [4.0000000; 5.0000000; 6.0000000]|] |}];
  Tensor.print ~with_code:false ~with_grad:false `Default @@ hoo;
  [%expect
    {|
    ┌──────────────────────────────────────────┐
    │[1]: c2x3_hoo shape 0:2|1:3               │
    │┌──────┬─────────────────────────────────┐│
    ││      │axis 1                           ││
    │├──────┼─────────────────────────────────┤│
    ││axis 0│ 1.0000000  2.0000000  3.0000000 ││
    ││      │ 4.0000000  5.0000000  6.0000000 ││
    │└──────┴─────────────────────────────────┘│
    └──────────────────────────────────────────┘
    |}];
  let%op hey2 =
    [
      ((1, 2, 3), (4, 5, 6));
      ((7, 8, 9), (10, 11, 12));
      ((13, 14, 15), (16, 17, 18));
      ((19, 20, 21), (22, 23, 24));
    ]
  in
  Train.forward_and_forget backend ctx hey2;
  Tensor.print ~with_code:false ~with_grad:false `Inline @@ hey2;
  [%expect
    {|
    [(1.0000000, 2.0000000, 3.0000000), (4.0000000, 5.0000000, 6.0000000);
      (7.0000000, 8.0000000, 9.0000000), (10.0000000, 11.0000000, 12.0000000);
      (13.0000000, 14.0000000, 15.0000000), (16.0000000, 17.0000000, 18.0000000);
      (19.0000000, 20.0000000, 21.0000000), (22.0000000, 23.0000000, 24.0000000)]
    |}];
  Tensor.print ~with_code:false ~with_grad:false `Default @@ hey2;
  [%expect
    {|
    ┌──────────────────────────────────────────────────────────────────────────────────────────────┐
    │[2]: c4x2x3_hey2 shape 1:2,2:3->0:4                                                           │
    │┌──────┬──────────────────────────────────────────┬──────────────────────────────────────────┐│
    ││      │0 @ 1                                     │1 @ 1                                     ││
    ││      │axis 2                                    │axis 2                                    ││
    │├──────┼──────────────────────────────────────────┼──────────────────────────────────────────┤│
    ││axis 0│ 1.0000000     2.0000000     3.0000000    │ 4.0000000     5.0000000     6.0000000    ││
    ││      │ 7.0000000     8.0000000     9.0000000    │ 1.0000000e+1  1.1000000e+1  1.2000000e+1 ││
    ││      │ 1.3000000e+1  1.4000000e+1  1.5000000e+1 │ 1.6000000e+1  1.7000000e+1  1.8000000e+1 ││
    ││      │ 1.9000000e+1  2.0000000e+1  2.1000000e+1 │ 2.2000000e+1  2.3000000e+1  2.4000000e+1 ││
    │└──────┴──────────────────────────────────────────┴──────────────────────────────────────────┘│
    └──────────────────────────────────────────────────────────────────────────────────────────────┘
    |}];
  let%op hoo2 =
    [|
      [ [ 1; 2; 3 ]; [ 4; 5; 6 ] ];
      [ [ 7; 8; 9 ]; [ 10; 11; 12 ] ];
      [ [ 13; 14; 15 ]; [ 16; 17; 18 ] ];
      [ [ 19; 20; 21 ]; [ 22; 23; 24 ] ];
    |]
  in
  Train.forward_and_forget backend ctx hoo2;
  Tensor.print ~with_code:false ~with_grad:false `Inline @@ hoo2;
  [%expect
    {|
    [|[[1.0000000; 2.0000000; 3.0000000]; [4.0000000; 5.0000000; 6.0000000]];
      [[7.0000000; 8.0000000; 9.0000000]; [10.0000000; 11.0000000; 12.0000000]];
      [[13.0000000; 14.0000000; 15.0000000]; [16.0000000; 17.0000000; 18.0000000]
        ];
      [[19.0000000; 20.0000000; 21.0000000]; [22.0000000; 23.0000000; 24.0000000]
        ]|]
    |}];
  Tensor.print ~with_code:false ~with_grad:false `Default @@ hoo2;
  [%expect
    {|
    ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
    │[3]: c4x2x3_hoo2 shape 0:4|1:2,2:3                                                                                                                                         │
    │┌──────┬─────────────────────────────────┬──────────────────────────────────────────┬──────────────────────────────────────────┬──────────────────────────────────────────┐│
    ││      │0 @ 0                            │1 @ 0                                     │2 @ 0                                     │3 @ 0                                     ││
    ││      │axis 2                           │axis 2                                    │axis 2                                    │axis 2                                    ││
    │├──────┼─────────────────────────────────┼──────────────────────────────────────────┼──────────────────────────────────────────┼──────────────────────────────────────────┤│
    ││axis 1│ 1.0000000  2.0000000  3.0000000 │ 7.0000000     8.0000000     9.0000000    │ 1.3000000e+1  1.4000000e+1  1.5000000e+1 │ 1.9000000e+1  2.0000000e+1  2.1000000e+1 ││
    ││      │ 4.0000000  5.0000000  6.0000000 │ 1.0000000e+1  1.1000000e+1  1.2000000e+1 │ 1.6000000e+1  1.7000000e+1  1.8000000e+1 │ 2.2000000e+1  2.3000000e+1  2.4000000e+1 ││
    │└──────┴─────────────────────────────────┴──────────────────────────────────────────┴──────────────────────────────────────────┴──────────────────────────────────────────┘│
    └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
    |}];
  let%op heyhoo =
    [|
      [| [ 1; 2; 3 ]; [ 4; 5; 6 ] |];
      [| [ 7; 8; 9 ]; [ 10; 11; 12 ] |];
      [| [ 13; 14; 15 ]; [ 16; 17; 18 ] |];
      [| [ 19; 20; 21 ]; [ 22; 23; 24 ] |];
    |]
  in
  Train.forward_and_forget backend ctx heyhoo;
  Tensor.print ~with_code:false ~with_grad:false `Inline @@ heyhoo;
  [%expect
    {|
    [|[|[1.0000000; 2.0000000; 3.0000000]; [4.0000000; 5.0000000; 6.0000000]|];
      [|[7.0000000; 8.0000000; 9.0000000]; [10.0000000; 11.0000000; 12.0000000]|];
      [|[13.0000000; 14.0000000; 15.0000000];
        [16.0000000; 17.0000000; 18.0000000]|];
      [|[19.0000000; 20.0000000; 21.0000000];
        [22.0000000; 23.0000000; 24.0000000]|]|]
    |}];
  Tensor.print ~with_code:false ~with_grad:false `Default @@ heyhoo;
  [%expect
    {|
    ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
    │[4]: c4x2x3_heyhoo shape 0:4,1:2|2:3                                                                                                                                       │
    │┌──────┬─────────────────────────────────┬──────────────────────────────────────────┬──────────────────────────────────────────┬──────────────────────────────────────────┐│
    ││      │0 @ 0                            │1 @ 0                                     │2 @ 0                                     │3 @ 0                                     ││
    ││      │axis 2                           │axis 2                                    │axis 2                                    │axis 2                                    ││
    │├──────┼─────────────────────────────────┼──────────────────────────────────────────┼──────────────────────────────────────────┼──────────────────────────────────────────┤│
    ││axis 1│ 1.0000000  2.0000000  3.0000000 │ 7.0000000     8.0000000     9.0000000    │ 1.3000000e+1  1.4000000e+1  1.5000000e+1 │ 1.9000000e+1  2.0000000e+1  2.1000000e+1 ││
    ││      │ 4.0000000  5.0000000  6.0000000 │ 1.0000000e+1  1.1000000e+1  1.2000000e+1 │ 1.6000000e+1  1.7000000e+1  1.8000000e+1 │ 2.2000000e+1  2.3000000e+1  2.4000000e+1 ││
    │└──────┴─────────────────────────────────┴──────────────────────────────────────────┴──────────────────────────────────────────┴──────────────────────────────────────────┘│
    └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
    |}];
  let%op heyhoo2 =
    [|
      [| [ [ 1; 31 ]; [ 2; 32 ]; [ 3; 33 ] ]; [ [ 4; 34 ]; [ 5; 35 ]; [ 6; 36 ] ] |];
      [| [ [ 7; 37 ]; [ 8; 38 ]; [ 9; 39 ] ]; [ [ 10; 40 ]; [ 11; 41 ]; [ 12; 42 ] ] |];
      [| [ [ 13; 43 ]; [ 14; 44 ]; [ 15; 45 ] ]; [ [ 16; 46 ]; [ 17; 47 ]; [ 18; 48 ] ] |];
      [| [ [ 19; 49 ]; [ 20; 50 ]; [ 21; 51 ] ]; [ [ 22; 52 ]; [ 23; 53 ]; [ 24; 54 ] ] |];
    |]
  in
  Train.forward_and_forget backend ctx heyhoo2;
  Tensor.print ~with_code:false ~with_grad:false `Inline @@ heyhoo2;
  [%expect
    {|
    [|
      [|
        [[1.0000000; 31.0000000]; [2.0000000; 32.0000000];
          [3.0000000; 33.0000000]];
        [[4.0000000; 34.0000000]; [5.0000000; 35.0000000];
          [6.0000000; 36.0000000]]|];
      [|
        [[7.0000000; 37.0000000]; [8.0000000; 38.0000000];
          [9.0000000; 39.0000000]];
        [[10.0000000; 40.0000000]; [11.0000000; 41.0000000];
          [12.0000000; 42.0000000]]|];
      [|
        [[13.0000000; 43.0000000]; [14.0000000; 44.0000000];
          [15.0000000; 45.0000000]];
        [[16.0000000; 46.0000000]; [17.0000000; 47.0000000];
          [18.0000000; 48.0000000]]|];
      [|
        [[19.0000000; 49.0000000]; [20.0000000; 50.0000000];
          [21.0000000; 51.0000000]];
        [[22.0000000; 52.0000000]; [23.0000000; 53.0000000];
          [24.0000000; 54.0000000]]|]|]
    |}];
  Tensor.print ~with_code:false ~with_grad:false `Default @@ heyhoo2;
  [%expect
    {|
    ┌──────────────────────────────────────────────────────────────────┐
    │[5]: c4x2x3x2_heyhoo2 shape 0:4,1:2|2:3,3:2                       │
    │┌──────┬────────────────────────────┬────────────────────────────┐│
    ││      │0 @ 1                       │1 @ 1                       ││
    ││      │axis 3                      │axis 3                      ││
    │├──────┼────────────────────────────┼────────────────────────────┤│
    ││0 @ 0 │ 1.0000000  3.1000000e+1    │ 4.0000000  3.4000000e+1    ││
    ││axis 2│ 2.0000000  3.2000000e+1    │ 5.0000000  3.5000000e+1    ││
    ││      │ 3.0000000  3.3000000e+1    │ 6.0000000  3.6000000e+1    ││
    │├──────┼────────────────────────────┼────────────────────────────┤│
    ││1 @ 0 │ 7.0000000  3.7000000e+1    │ 1.0000000e+1  4.0000000e+1 ││
    ││axis 2│ 8.0000000  3.8000000e+1    │ 1.1000000e+1  4.1000000e+1 ││
    ││      │ 9.0000000  3.9000000e+1    │ 1.2000000e+1  4.2000000e+1 ││
    │├──────┼────────────────────────────┼────────────────────────────┤│
    ││2 @ 0 │ 1.3000000e+1  4.3000000e+1 │ 1.6000000e+1  4.6000000e+1 ││
    ││axis 2│ 1.4000000e+1  4.4000000e+1 │ 1.7000000e+1  4.7000000e+1 ││
    ││      │ 1.5000000e+1  4.5000000e+1 │ 1.8000000e+1  4.8000000e+1 ││
    │├──────┼────────────────────────────┼────────────────────────────┤│
    ││3 @ 0 │ 1.9000000e+1  4.9000000e+1 │ 2.2000000e+1  5.2000000e+1 ││
    ││axis 2│ 2.0000000e+1  5.0000000e+1 │ 2.3000000e+1  5.3000000e+1 ││
    ││      │ 2.1000000e+1  5.1000000e+1 │ 2.4000000e+1  5.4000000e+1 ││
    │└──────┴────────────────────────────┴────────────────────────────┘│
    └──────────────────────────────────────────────────────────────────┘
    |}];
  let%op heyhoo3 =
    [|
      [|
        [ [ [ 1; 31 ]; [ 2; 32 ]; [ 3; 33 ] ]; [ [ 4; 34 ]; [ 5; 35 ]; [ 6; 36 ] ] ];
        [ [ [ 7; 37 ]; [ 8; 38 ]; [ 9; 39 ] ]; [ [ 10; 40 ]; [ 11; 41 ]; [ 12; 42 ] ] ];
      |];
      [|
        [ [ [ 13; 43 ]; [ 14; 44 ]; [ 15; 45 ] ]; [ [ 16; 46 ]; [ 17; 47 ]; [ 18; 48 ] ] ];
        [ [ [ 19; 49 ]; [ 20; 50 ]; [ 21; 51 ] ]; [ [ 22; 52 ]; [ 23; 53 ]; [ 24; 54 ] ] ];
      |];
    |]
  in
  Train.forward_and_forget backend ctx heyhoo3;
  Tensor.print ~with_code:false ~with_grad:false `Inline @@ heyhoo3;
  [%expect
    {|
    [|
      [|
        [
          [[1.0000000; 31.0000000]; [2.0000000; 32.0000000];
            [3.0000000; 33.0000000]];
          [[4.0000000; 34.0000000]; [5.0000000; 35.0000000];
            [6.0000000; 36.0000000]]];
        [
          [[7.0000000; 37.0000000]; [8.0000000; 38.0000000];
            [9.0000000; 39.0000000]];
          [[10.0000000; 40.0000000]; [11.0000000; 41.0000000];
            [12.0000000; 42.0000000]]]|];
      [|
        [
          [[13.0000000; 43.0000000]; [14.0000000; 44.0000000];
            [15.0000000; 45.0000000]];
          [[16.0000000; 46.0000000]; [17.0000000; 47.0000000];
            [18.0000000; 48.0000000]]];
        [
          [[19.0000000; 49.0000000]; [20.0000000; 50.0000000];
            [21.0000000; 51.0000000]];
          [[22.0000000; 52.0000000]; [23.0000000; 53.0000000];
            [24.0000000; 54.0000000]]]|]|]
    |}];
  Tensor.print ~with_code:false ~with_grad:false `Default @@ heyhoo3;
  [%expect
    {|
    ┌──────────────────────────────────────────────────────────────────┐
    │[6]: c2x2x2x3x2_heyhoo3 shape 0:2,1:2|2:2,3:3,4:2                 │
    │┌──────┬─────────────────────────┬────────────────────────────┐   │
    ││0 @ 0 │0 @ 2                    │1 @ 2                       │   │
    ││      │axis 4                   │axis 4                      │   │
    │├──────┼─────────────────────────┼────────────────────────────┤   │
    ││0 @ 1 │ 1.0000000  3.1000000e+1 │ 4.0000000  3.4000000e+1    │   │
    ││axis 3│ 2.0000000  3.2000000e+1 │ 5.0000000  3.5000000e+1    │   │
    ││      │ 3.0000000  3.3000000e+1 │ 6.0000000  3.6000000e+1    │   │
    │├──────┼─────────────────────────┼────────────────────────────┤   │
    ││1 @ 1 │ 7.0000000  3.7000000e+1 │ 1.0000000e+1  4.0000000e+1 │   │
    ││axis 3│ 8.0000000  3.8000000e+1 │ 1.1000000e+1  4.1000000e+1 │   │
    ││      │ 9.0000000  3.9000000e+1 │ 1.2000000e+1  4.2000000e+1 │   │
    │└──────┴─────────────────────────┴────────────────────────────┘   │
    ├──────────────────────────────────────────────────────────────────┤
    │┌──────┬────────────────────────────┬────────────────────────────┐│
    ││1 @ 0 │0 @ 2                       │1 @ 2                       ││
    ││      │axis 4                      │axis 4                      ││
    │├──────┼────────────────────────────┼────────────────────────────┤│
    ││0 @ 1 │ 1.3000000e+1  4.3000000e+1 │ 1.6000000e+1  4.6000000e+1 ││
    ││axis 3│ 1.4000000e+1  4.4000000e+1 │ 1.7000000e+1  4.7000000e+1 ││
    ││      │ 1.5000000e+1  4.5000000e+1 │ 1.8000000e+1  4.8000000e+1 ││
    │├──────┼────────────────────────────┼────────────────────────────┤│
    ││1 @ 1 │ 1.9000000e+1  4.9000000e+1 │ 2.2000000e+1  5.2000000e+1 ││
    ││axis 3│ 2.0000000e+1  5.0000000e+1 │ 2.3000000e+1  5.3000000e+1 ││
    ││      │ 2.1000000e+1  5.1000000e+1 │ 2.4000000e+1  5.4000000e+1 ││
    │└──────┴────────────────────────────┴────────────────────────────┘│
    └──────────────────────────────────────────────────────────────────┘
    |}];
  let%op heyhoo4 =
    [|
      [
        [ [ (1, 31); (2, 32); (3, 33) ]; [ (4, 34); (5, 35); (6, 36) ] ];
        [ [ (7, 37); (8, 38); (9, 39) ]; [ (10, 40); (11, 41); (12, 42) ] ];
      ];
      [
        [ [ (13, 43); (14, 44); (15, 45) ]; [ (16, 46); (17, 47); (18, 48) ] ];
        [ [ (19, 49); (20, 50); (21, 51) ]; [ (22, 52); (23, 53); (24, 54) ] ];
      ];
    |]
  in
  Train.forward_and_forget backend ctx heyhoo4;
  Tensor.print ~with_code:false ~with_grad:false `Inline @@ heyhoo4;
  [%expect
    {|
    [|
      [
        [[1.0000000, 31.0000000; 2.0000000, 32.0000000; 3.0000000, 33.0000000];
          [4.0000000, 34.0000000; 5.0000000, 35.0000000; 6.0000000, 36.0000000]];
        [[7.0000000, 37.0000000; 8.0000000, 38.0000000; 9.0000000, 39.0000000];
          [10.0000000, 40.0000000; 11.0000000, 41.0000000; 12.0000000, 42.0000000
            ]]];
      [
        [
          [13.0000000, 43.0000000; 14.0000000, 44.0000000; 15.0000000, 45.0000000];
          [16.0000000, 46.0000000; 17.0000000, 47.0000000; 18.0000000, 48.0000000
            ]];
        [
          [19.0000000, 49.0000000; 20.0000000, 50.0000000; 21.0000000, 51.0000000];
          [22.0000000, 52.0000000; 23.0000000, 53.0000000; 24.0000000, 54.0000000
            ]]]|]
    |}];
  Tensor.print ~with_code:false ~with_grad:false `Default @@ heyhoo4;
  [%expect
    {|
    ┌──────────────────────────────────────────────────────────────────┐
    │[7]: c2x2x2x3x2_heyhoo4 shape 0:2|4:2->1:2,2:2,3:3                │
    │┌──────┬─────────────────────────┬────────────────────────────┐   │
    ││0 @ 0 │0 @ 2                    │1 @ 2                       │   │
    ││      │axis 4                   │axis 4                      │   │
    │├──────┼─────────────────────────┼────────────────────────────┤   │
    ││0 @ 1 │ 1.0000000  3.1000000e+1 │ 4.0000000  3.4000000e+1    │   │
    ││axis 3│ 2.0000000  3.2000000e+1 │ 5.0000000  3.5000000e+1    │   │
    ││      │ 3.0000000  3.3000000e+1 │ 6.0000000  3.6000000e+1    │   │
    │├──────┼─────────────────────────┼────────────────────────────┤   │
    ││1 @ 1 │ 7.0000000  3.7000000e+1 │ 1.0000000e+1  4.0000000e+1 │   │
    ││axis 3│ 8.0000000  3.8000000e+1 │ 1.1000000e+1  4.1000000e+1 │   │
    ││      │ 9.0000000  3.9000000e+1 │ 1.2000000e+1  4.2000000e+1 │   │
    │└──────┴─────────────────────────┴────────────────────────────┘   │
    ├──────────────────────────────────────────────────────────────────┤
    │┌──────┬────────────────────────────┬────────────────────────────┐│
    ││1 @ 0 │0 @ 2                       │1 @ 2                       ││
    ││      │axis 4                      │axis 4                      ││
    │├──────┼────────────────────────────┼────────────────────────────┤│
    ││0 @ 1 │ 1.3000000e+1  4.3000000e+1 │ 1.6000000e+1  4.6000000e+1 ││
    ││axis 3│ 1.4000000e+1  4.4000000e+1 │ 1.7000000e+1  4.7000000e+1 ││
    ││      │ 1.5000000e+1  4.5000000e+1 │ 1.8000000e+1  4.8000000e+1 ││
    │├──────┼────────────────────────────┼────────────────────────────┤│
    ││1 @ 1 │ 1.9000000e+1  4.9000000e+1 │ 2.2000000e+1  5.2000000e+1 ││
    ││axis 3│ 2.0000000e+1  5.0000000e+1 │ 2.3000000e+1  5.3000000e+1 ││
    ││      │ 2.1000000e+1  5.1000000e+1 │ 2.4000000e+1  5.4000000e+1 ││
    │└──────┴────────────────────────────┴────────────────────────────┘│
    └──────────────────────────────────────────────────────────────────┘
    |}]

let%expect_test "Matrix multiplication dims 2x3" =
  Tensor.unsafe_reinitialize ();
  let module Backend = (val Arrayjit.Backends.fresh_backend ()) in
  let backend =
    (module Backend : Backend
      with type buffer_ptr = Backend.buffer_ptr
       and type dev = Backend.dev
       and type runner = Backend.runner
       and type event = Backend.event)
  in
  let stream = Backend.(new_stream @@ get_device ~ordinal:0) in
  let ctx = Backend.make_context stream in
  Rand.init 0;
  (* Hey is inferred to be a matrix. *)
  let%op y = ("hey" 7.0 * [ 2; 3 ]) + [ 4; 5; 6 ] in
  Train.forward_and_forget backend ctx y;
  Tensor.print ~with_code:false ~with_grad:false `Default @@ hey;
  [%expect
    {|
    ┌───────────────────────────────┐
    │[0]: hey shape 1:2->0:3        │
    │┌──────┬──────────────────────┐│
    ││      │axis 1                ││
    │├──────┼──────────────────────┤│
    ││axis 0│ 7.0000000  7.0000000 ││
    ││      │ 7.0000000  7.0000000 ││
    ││      │ 7.0000000  7.0000000 ││
    │└──────┴──────────────────────┘│
    └───────────────────────────────┘
    |}];
  Tensor.print ~with_code:false ~with_grad:false `Default @@ y;
  [%expect
    {|
    ┌─────────────────────────────────────────────┐
    │[6]: +_y shape 0:3                           │
    │┌┬──────────────────────────────────────────┐│
    │││axis 0                                    ││
    │├┼──────────────────────────────────────────┤│
    │││ 3.9000000e+1  4.0000000e+1  4.1000000e+1 ││
    │└┴──────────────────────────────────────────┘│
    └─────────────────────────────────────────────┘
    |}]

let%expect_test "Big matrix" =
  Tensor.unsafe_reinitialize ();
  let module Backend = (val Arrayjit.Backends.fresh_backend ()) in
  let backend =
    (module Backend : Backend
      with type buffer_ptr = Backend.buffer_ptr
       and type dev = Backend.dev
       and type runner = Backend.runner
       and type event = Backend.event)
  in
  let stream = Backend.(new_stream @@ get_device ~ordinal:0) in
  let ctx = Backend.make_context stream in
  Rand.init 0;
  (* Hey is inferred to be a matrix. *)
  let hey = Tensor.param ~values:[| 0.5 |] "hey" in
  let zero_to_twenty = TDSL.range 20 in
  let y = TDSL.O.((hey * zero_to_twenty) + zero_to_twenty) in
  Train.forward_and_forget backend ctx y;
  Tensor.print ~with_code:false ~with_grad:false `Inline zero_to_twenty;
  [%expect
    {|
    [0.0000000; 1.0000000; 2.0000000; 3.0000000; 4.0000000; 5.0000000; 6.0000000;
      7.0000000; 8.0000000; 9.0000000; 10.0000000; 11.0000000; 12.0000000;
      13.0000000; 14.0000000; 15.0000000; 16.0000000; 17.0000000; 18.0000000;
      19.0000000; 20.0000000]
    |}];
  Tensor.print ~with_code:false ~with_grad:false `Default zero_to_twenty;
  [%expect
    {|
    ┌──────────────────────────────────────────────────────────┐
    │[2]: 0...20 shape 0:21                                    │
    │┌┬───────────────────────────────────────────────────────┐│
    │││axis 0                                                 ││
    │├┼───────────────────────────────────────────────────────┤│
    │││ 0.0000000  1.0000000  ...  1.9000000e+1  2.0000000e+1 ││
    │└┴───────────────────────────────────────────────────────┘│
    └──────────────────────────────────────────────────────────┘
    |}];
  Tensor.print ~with_code:false ~with_grad:false `Default hey;
  [%expect
    {|
    ┌──────────────────────────────────────────────────────────────────────┐
    │[0]: hey shape 1:21->0:21                                             │
    │┌──────┬─────────────────────────────────────────────────────────────┐│
    ││      │axis 1                                                       ││
    │├──────┼─────────────────────────────────────────────────────────────┤│
    ││axis 0│ 5.0000000e-1  5.0000000e-1  ...  5.0000000e-1  5.0000000e-1 ││
    ││      │ 5.0000000e-1  5.0000000e-1  ...  5.0000000e-1  5.0000000e-1 ││
    ││      │ ...           ...           ...  ...           ...          ││
    ││      │ 5.0000000e-1  5.0000000e-1  ...  5.0000000e-1  5.0000000e-1 ││
    ││      │ 5.0000000e-1  5.0000000e-1  ...  5.0000000e-1  5.0000000e-1 ││
    │└──────┴─────────────────────────────────────────────────────────────┘│
    └──────────────────────────────────────────────────────────────────────┘
    |}];
  Tensor.print ~with_code:false ~with_grad:false `Default y;
  [%expect
    {|
    ┌────────────────────────────────────────────────────────────────┐
    │[5]: + shape 0:21                                               │
    │┌┬─────────────────────────────────────────────────────────────┐│
    │││axis 0                                                       ││
    │├┼─────────────────────────────────────────────────────────────┤│
    │││ 1.0500000e+2  1.0600000e+2  ...  1.2400000e+2  1.2500000e+2 ││
    │└┴─────────────────────────────────────────────────────────────┘│
    └────────────────────────────────────────────────────────────────┘
    |}]

let%expect_test "Very big tensor" =
  Tensor.unsafe_reinitialize ();
  let module Backend = (val Arrayjit.Backends.fresh_backend ()) in
  let backend =
    (module Backend : Backend
      with type buffer_ptr = Backend.buffer_ptr
       and type dev = Backend.dev
       and type runner = Backend.runner
       and type event = Backend.event)
  in
  let stream = Backend.(new_stream @@ get_device ~ordinal:0) in
  let ctx = Backend.make_context stream in
  Rand.init 0;
  let hey =
    TDSL.range_of_shape ~batch_dims:[ 6 ] ~input_dims:[ 7; 8; 9 ] ~output_dims:[ 10; 11 ] ()
  in
  let%op hoo = (hey * (1 + 1)) - 10 in
  Train.forward_and_forget backend ctx hoo;
  Tensor.print ~with_code:false ~with_grad:false `Default hey;
  [%expect
    {|
    ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
    │[0]: r6x10x11x7x8x9 shape 0:6|3:7,4:8,5:9->1:10,2:11                                                                                                                                                                                                                   │
    │┌──────┬─────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────┬──────┬─────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────┐│
    ││0 @ 0 │0 @ 4                                                        │1 @ 4                                                        │~~~~~ │6 @ 4                                                        │7 @ 4                                                        ││
    ││      │axis 5                                                       │axis 5                                                       │axis 5│axis 5                                                       │axis 5                                                       ││
    │├──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┤│
    ││0 @ 1 │ 0.0000000     1.0000000     ...  7.0000000     8.0000000    │ 9.0000000     1.0000000e+1  ...  1.6000000e+1  1.7000000e+1 │ ...  │ 5.4000000e+1  5.5000000e+1  ...  6.1000000e+1  6.2000000e+1 │ 6.3000000e+1  6.4000000e+1  ...  7.0000000e+1  7.1000000e+1 ││
    ││axis 2│ 5.0400000e+2  5.0500000e+2  ...  5.1100000e+2  5.1200000e+2 │ 5.1300000e+2  5.1400000e+2  ...  5.2000000e+2  5.2100000e+2 │      │ 5.5800000e+2  5.5900000e+2  ...  5.6500000e+2  5.6600000e+2 │ 5.6700000e+2  5.6800000e+2  ...  5.7400000e+2  5.7500000e+2 ││
    ││      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          │      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          ││
    ││      │ 4.5360000e+3  4.5370000e+3  ...  4.5430000e+3  4.5440000e+3 │ 4.5450000e+3  4.5460000e+3  ...  4.5520000e+3  4.5530000e+3 │      │ 4.5900000e+3  4.5910000e+3  ...  4.5970000e+3  4.5980000e+3 │ 4.5990000e+3  4.6000000e+3  ...  4.6060000e+3  4.6070000e+3 ││
    ││      │ 5.0400000e+3  5.0410000e+3  ...  5.0470000e+3  5.0480000e+3 │ 5.0490000e+3  5.0500000e+3  ...  5.0560000e+3  5.0570000e+3 │      │ 5.0940000e+3  5.0950000e+3  ...  5.1010000e+3  5.1020000e+3 │ 5.1030000e+3  5.1040000e+3  ...  5.1100000e+3  5.1110000e+3 ││
    │├──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┤│
    ││1 @ 1 │ 5.5440000e+3  5.5450000e+3  ...  5.5510000e+3  5.5520000e+3 │ 5.5530000e+3  5.5540000e+3  ...  5.5600000e+3  5.5610000e+3 │ ...  │ 5.5980000e+3  5.5990000e+3  ...  5.6050000e+3  5.6060000e+3 │ 5.6070000e+3  5.6080000e+3  ...  5.6140000e+3  5.6150000e+3 ││
    ││axis 2│ 6.0480000e+3  6.0490000e+3  ...  6.0550000e+3  6.0560000e+3 │ 6.0570000e+3  6.0580000e+3  ...  6.0640000e+3  6.0650000e+3 │      │ 6.1020000e+3  6.1030000e+3  ...  6.1090000e+3  6.1100000e+3 │ 6.1110000e+3  6.1120000e+3  ...  6.1180000e+3  6.1190000e+3 ││
    ││      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          │      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          ││
    ││      │ 1.0080000e+4  1.0081000e+4  ...  1.0087000e+4  1.0088000e+4 │ 1.0089000e+4  1.0090000e+4  ...  1.0096000e+4  1.0097000e+4 │      │ 1.0134000e+4  1.0135000e+4  ...  1.0141000e+4  1.0142000e+4 │ 1.0143000e+4  1.0144000e+4  ...  1.0150000e+4  1.0151000e+4 ││
    ││      │ 1.0584000e+4  1.0585000e+4  ...  1.0591000e+4  1.0592000e+4 │ 1.0593000e+4  1.0594000e+4  ...  1.0600000e+4  1.0601000e+4 │      │ 1.0638000e+4  1.0639000e+4  ...  1.0645000e+4  1.0646000e+4 │ 1.0647000e+4  1.0648000e+4  ...  1.0654000e+4  1.0655000e+4 ││
    │├──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┤│
    ││~~~~~ │ ...                                                         │ ...                                                         │ ...  │ ...                                                         │ ...                                                         ││
    ││axis 2│                                                             │                                                             │      │                                                             │                                                             ││
    │├──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┤│
    ││8 @ 1 │ 4.4352000e+4  4.4353000e+4  ...  4.4359000e+4  4.4360000e+4 │ 4.4361000e+4  4.4362000e+4  ...  4.4368000e+4  4.4369000e+4 │ ...  │ 4.4406000e+4  4.4407000e+4  ...  4.4413000e+4  4.4414000e+4 │ 4.4415000e+4  4.4416000e+4  ...  4.4422000e+4  4.4423000e+4 ││
    ││axis 2│ 4.4856000e+4  4.4857000e+4  ...  4.4863000e+4  4.4864000e+4 │ 4.4865000e+4  4.4866000e+4  ...  4.4872000e+4  4.4873000e+4 │      │ 4.4910000e+4  4.4911000e+4  ...  4.4917000e+4  4.4918000e+4 │ 4.4919000e+4  4.4920000e+4  ...  4.4926000e+4  4.4927000e+4 ││
    ││      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          │      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          ││
    ││      │ 4.8888000e+4  4.8889000e+4  ...  4.8895000e+4  4.8896000e+4 │ 4.8897000e+4  4.8898000e+4  ...  4.8904000e+4  4.8905000e+4 │      │ 4.8942000e+4  4.8943000e+4  ...  4.8949000e+4  4.8950000e+4 │ 4.8951000e+4  4.8952000e+4  ...  4.8958000e+4  4.8959000e+4 ││
    ││      │ 4.9392000e+4  4.9393000e+4  ...  4.9399000e+4  4.9400000e+4 │ 4.9401000e+4  4.9402000e+4  ...  4.9408000e+4  4.9409000e+4 │      │ 4.9446000e+4  4.9447000e+4  ...  4.9453000e+4  4.9454000e+4 │ 4.9455000e+4  4.9456000e+4  ...  4.9462000e+4  4.9463000e+4 ││
    │├──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┤│
    ││9 @ 1 │ 4.9896000e+4  4.9897000e+4  ...  4.9903000e+4  4.9904000e+4 │ 4.9905000e+4  4.9906000e+4  ...  4.9912000e+4  4.9913000e+4 │ ...  │ 4.9950000e+4  4.9951000e+4  ...  4.9957000e+4  4.9958000e+4 │ 4.9959000e+4  4.9960000e+4  ...  4.9966000e+4  4.9967000e+4 ││
    ││axis 2│ 5.0400000e+4  5.0401000e+4  ...  5.0407000e+4  5.0408000e+4 │ 5.0409000e+4  5.0410000e+4  ...  5.0416000e+4  5.0417000e+4 │      │ 5.0454000e+4  5.0455000e+4  ...  5.0461000e+4  5.0462000e+4 │ 5.0463000e+4  5.0464000e+4  ...  5.0470000e+4  5.0471000e+4 ││
    ││      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          │      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          ││
    ││      │ 5.4432000e+4  5.4433000e+4  ...  5.4439000e+4  5.4440000e+4 │ 5.4441000e+4  5.4442000e+4  ...  5.4448000e+4  5.4449000e+4 │      │ 5.4486000e+4  5.4487000e+4  ...  5.4493000e+4  5.4494000e+4 │ 5.4495000e+4  5.4496000e+4  ...  5.4502000e+4  5.4503000e+4 ││
    ││      │ 5.4936000e+4  5.4937000e+4  ...  5.4943000e+4  5.4944000e+4 │ 5.4945000e+4  5.4946000e+4  ...  5.4952000e+4  5.4953000e+4 │      │ 5.4990000e+4  5.4991000e+4  ...  5.4997000e+4  5.4998000e+4 │ 5.4999000e+4  5.5000000e+4  ...  5.5006000e+4  5.5007000e+4 ││
    │└──────┴─────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────┴──────┴─────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────┘│
    ├───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
    │┌──────┬─────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────┬──────┬─────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────┐│
    ││1 @ 0 │0 @ 4                                                        │1 @ 4                                                        │~~~~~ │6 @ 4                                                        │7 @ 4                                                        ││
    ││      │axis 5                                                       │axis 5                                                       │axis 5│axis 5                                                       │axis 5                                                       ││
    │├──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┤│
    ││0 @ 1 │ 5.5440000e+4  5.5441000e+4  ...  5.5447000e+4  5.5448000e+4 │ 5.5449000e+4  5.5450000e+4  ...  5.5456000e+4  5.5457000e+4 │ ...  │ 5.5494000e+4  5.5495000e+4  ...  5.5501000e+4  5.5502000e+4 │ 5.5503000e+4  5.5504000e+4  ...  5.5510000e+4  5.5511000e+4 ││
    ││axis 2│ 5.5944000e+4  5.5945000e+4  ...  5.5951000e+4  5.5952000e+4 │ 5.5953000e+4  5.5954000e+4  ...  5.5960000e+4  5.5961000e+4 │      │ 5.5998000e+4  5.5999000e+4  ...  5.6005000e+4  5.6006000e+4 │ 5.6007000e+4  5.6008000e+4  ...  5.6014000e+4  5.6015000e+4 ││
    ││      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          │      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          ││
    ││      │ 5.9976000e+4  5.9977000e+4  ...  5.9983000e+4  5.9984000e+4 │ 5.9985000e+4  5.9986000e+4  ...  5.9992000e+4  5.9993000e+4 │      │ 6.0030000e+4  6.0031000e+4  ...  6.0037000e+4  6.0038000e+4 │ 6.0039000e+4  6.0040000e+4  ...  6.0046000e+4  6.0047000e+4 ││
    ││      │ 6.0480000e+4  6.0481000e+4  ...  6.0487000e+4  6.0488000e+4 │ 6.0489000e+4  6.0490000e+4  ...  6.0496000e+4  6.0497000e+4 │      │ 6.0534000e+4  6.0535000e+4  ...  6.0541000e+4  6.0542000e+4 │ 6.0543000e+4  6.0544000e+4  ...  6.0550000e+4  6.0551000e+4 ││
    │├──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┤│
    ││1 @ 1 │ 6.0984000e+4  6.0985000e+4  ...  6.0991000e+4  6.0992000e+4 │ 6.0993000e+4  6.0994000e+4  ...  6.1000000e+4  6.1001000e+4 │ ...  │ 6.1038000e+4  6.1039000e+4  ...  6.1045000e+4  6.1046000e+4 │ 6.1047000e+4  6.1048000e+4  ...  6.1054000e+4  6.1055000e+4 ││
    ││axis 2│ 6.1488000e+4  6.1489000e+4  ...  6.1495000e+4  6.1496000e+4 │ 6.1497000e+4  6.1498000e+4  ...  6.1504000e+4  6.1505000e+4 │      │ 6.1542000e+4  6.1543000e+4  ...  6.1549000e+4  6.1550000e+4 │ 6.1551000e+4  6.1552000e+4  ...  6.1558000e+4  6.1559000e+4 ││
    ││      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          │      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          ││
    ││      │ 6.5520000e+4  6.5521000e+4  ...  6.5527000e+4  6.5528000e+4 │ 6.5529000e+4  6.5530000e+4  ...  6.5536000e+4  6.5537000e+4 │      │ 6.5574000e+4  6.5575000e+4  ...  6.5581000e+4  6.5582000e+4 │ 6.5583000e+4  6.5584000e+4  ...  6.5590000e+4  6.5591000e+4 ││
    ││      │ 6.6024000e+4  6.6025000e+4  ...  6.6031000e+4  6.6032000e+4 │ 6.6033000e+4  6.6034000e+4  ...  6.6040000e+4  6.6041000e+4 │      │ 6.6078000e+4  6.6079000e+4  ...  6.6085000e+4  6.6086000e+4 │ 6.6087000e+4  6.6088000e+4  ...  6.6094000e+4  6.6095000e+4 ││
    │├──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┤│
    ││~~~~~ │ ...                                                         │ ...                                                         │ ...  │ ...                                                         │ ...                                                         ││
    ││axis 2│                                                             │                                                             │      │                                                             │                                                             ││
    │├──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┤│
    ││8 @ 1 │ 9.9792000e+4  9.9793000e+4  ...  9.9799000e+4  9.9800000e+4 │ 9.9801000e+4  9.9802000e+4  ...  9.9808000e+4  9.9809000e+4 │ ...  │ 9.9846000e+4  9.9847000e+4  ...  9.9853000e+4  9.9854000e+4 │ 9.9855000e+4  9.9856000e+4  ...  9.9862000e+4  9.9863000e+4 ││
    ││axis 2│ 1.0029600e+5  1.0029700e+5  ...  1.0030300e+5  1.0030400e+5 │ 1.0030500e+5  1.0030600e+5  ...  1.0031200e+5  1.0031300e+5 │      │ 1.0035000e+5  1.0035100e+5  ...  1.0035700e+5  1.0035800e+5 │ 1.0035900e+5  1.0036000e+5  ...  1.0036600e+5  1.0036700e+5 ││
    ││      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          │      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          ││
    ││      │ 1.0432800e+5  1.0432900e+5  ...  1.0433500e+5  1.0433600e+5 │ 1.0433700e+5  1.0433800e+5  ...  1.0434400e+5  1.0434500e+5 │      │ 1.0438200e+5  1.0438300e+5  ...  1.0438900e+5  1.0439000e+5 │ 1.0439100e+5  1.0439200e+5  ...  1.0439800e+5  1.0439900e+5 ││
    ││      │ 1.0483200e+5  1.0483300e+5  ...  1.0483900e+5  1.0484000e+5 │ 1.0484100e+5  1.0484200e+5  ...  1.0484800e+5  1.0484900e+5 │      │ 1.0488600e+5  1.0488700e+5  ...  1.0489300e+5  1.0489400e+5 │ 1.0489500e+5  1.0489600e+5  ...  1.0490200e+5  1.0490300e+5 ││
    │├──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┤│
    ││9 @ 1 │ 1.0533600e+5  1.0533700e+5  ...  1.0534300e+5  1.0534400e+5 │ 1.0534500e+5  1.0534600e+5  ...  1.0535200e+5  1.0535300e+5 │ ...  │ 1.0539000e+5  1.0539100e+5  ...  1.0539700e+5  1.0539800e+5 │ 1.0539900e+5  1.0540000e+5  ...  1.0540600e+5  1.0540700e+5 ││
    ││axis 2│ 1.0584000e+5  1.0584100e+5  ...  1.0584700e+5  1.0584800e+5 │ 1.0584900e+5  1.0585000e+5  ...  1.0585600e+5  1.0585700e+5 │      │ 1.0589400e+5  1.0589500e+5  ...  1.0590100e+5  1.0590200e+5 │ 1.0590300e+5  1.0590400e+5  ...  1.0591000e+5  1.0591100e+5 ││
    ││      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          │      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          ││
    ││      │ 1.0987200e+5  1.0987300e+5  ...  1.0987900e+5  1.0988000e+5 │ 1.0988100e+5  1.0988200e+5  ...  1.0988800e+5  1.0988900e+5 │      │ 1.0992600e+5  1.0992700e+5  ...  1.0993300e+5  1.0993400e+5 │ 1.0993500e+5  1.0993600e+5  ...  1.0994200e+5  1.0994300e+5 ││
    ││      │ 1.1037600e+5  1.1037700e+5  ...  1.1038300e+5  1.1038400e+5 │ 1.1038500e+5  1.1038600e+5  ...  1.1039200e+5  1.1039300e+5 │      │ 1.1043000e+5  1.1043100e+5  ...  1.1043700e+5  1.1043800e+5 │ 1.1043900e+5  1.1044000e+5  ...  1.1044600e+5  1.1044700e+5 ││
    │└──────┴─────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────┴──────┴─────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────┘│
    ├───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
    │ ...                                                                                                                                                                                                                                                                   │
    ├───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
    │┌──────┬─────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────┬──────┬─────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────┐│
    ││4 @ 0 │0 @ 4                                                        │1 @ 4                                                        │~~~~~ │6 @ 4                                                        │7 @ 4                                                        ││
    ││      │axis 5                                                       │axis 5                                                       │axis 5│axis 5                                                       │axis 5                                                       ││
    │├──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┤│
    ││0 @ 1 │ 2.2176000e+5  2.2176100e+5  ...  2.2176700e+5  2.2176800e+5 │ 2.2176900e+5  2.2177000e+5  ...  2.2177600e+5  2.2177700e+5 │ ...  │ 2.2181400e+5  2.2181500e+5  ...  2.2182100e+5  2.2182200e+5 │ 2.2182300e+5  2.2182400e+5  ...  2.2183000e+5  2.2183100e+5 ││
    ││axis 2│ 2.2226400e+5  2.2226500e+5  ...  2.2227100e+5  2.2227200e+5 │ 2.2227300e+5  2.2227400e+5  ...  2.2228000e+5  2.2228100e+5 │      │ 2.2231800e+5  2.2231900e+5  ...  2.2232500e+5  2.2232600e+5 │ 2.2232700e+5  2.2232800e+5  ...  2.2233400e+5  2.2233500e+5 ││
    ││      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          │      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          ││
    ││      │ 2.2629600e+5  2.2629700e+5  ...  2.2630300e+5  2.2630400e+5 │ 2.2630500e+5  2.2630600e+5  ...  2.2631200e+5  2.2631300e+5 │      │ 2.2635000e+5  2.2635100e+5  ...  2.2635700e+5  2.2635800e+5 │ 2.2635900e+5  2.2636000e+5  ...  2.2636600e+5  2.2636700e+5 ││
    ││      │ 2.2680000e+5  2.2680100e+5  ...  2.2680700e+5  2.2680800e+5 │ 2.2680900e+5  2.2681000e+5  ...  2.2681600e+5  2.2681700e+5 │      │ 2.2685400e+5  2.2685500e+5  ...  2.2686100e+5  2.2686200e+5 │ 2.2686300e+5  2.2686400e+5  ...  2.2687000e+5  2.2687100e+5 ││
    │├──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┤│
    ││1 @ 1 │ 2.2730400e+5  2.2730500e+5  ...  2.2731100e+5  2.2731200e+5 │ 2.2731300e+5  2.2731400e+5  ...  2.2732000e+5  2.2732100e+5 │ ...  │ 2.2735800e+5  2.2735900e+5  ...  2.2736500e+5  2.2736600e+5 │ 2.2736700e+5  2.2736800e+5  ...  2.2737400e+5  2.2737500e+5 ││
    ││axis 2│ 2.2780800e+5  2.2780900e+5  ...  2.2781500e+5  2.2781600e+5 │ 2.2781700e+5  2.2781800e+5  ...  2.2782400e+5  2.2782500e+5 │      │ 2.2786200e+5  2.2786300e+5  ...  2.2786900e+5  2.2787000e+5 │ 2.2787100e+5  2.2787200e+5  ...  2.2787800e+5  2.2787900e+5 ││
    ││      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          │      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          ││
    ││      │ 2.3184000e+5  2.3184100e+5  ...  2.3184700e+5  2.3184800e+5 │ 2.3184900e+5  2.3185000e+5  ...  2.3185600e+5  2.3185700e+5 │      │ 2.3189400e+5  2.3189500e+5  ...  2.3190100e+5  2.3190200e+5 │ 2.3190300e+5  2.3190400e+5  ...  2.3191000e+5  2.3191100e+5 ││
    ││      │ 2.3234400e+5  2.3234500e+5  ...  2.3235100e+5  2.3235200e+5 │ 2.3235300e+5  2.3235400e+5  ...  2.3236000e+5  2.3236100e+5 │      │ 2.3239800e+5  2.3239900e+5  ...  2.3240500e+5  2.3240600e+5 │ 2.3240700e+5  2.3240800e+5  ...  2.3241400e+5  2.3241500e+5 ││
    │├──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┤│
    ││~~~~~ │ ...                                                         │ ...                                                         │ ...  │ ...                                                         │ ...                                                         ││
    ││axis 2│                                                             │                                                             │      │                                                             │                                                             ││
    │├──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┤│
    ││8 @ 1 │ 2.6611200e+5  2.6611300e+5  ...  2.6611900e+5  2.6612000e+5 │ 2.6612100e+5  2.6612200e+5  ...  2.6612800e+5  2.6612900e+5 │ ...  │ 2.6616600e+5  2.6616700e+5  ...  2.6617300e+5  2.6617400e+5 │ 2.6617500e+5  2.6617600e+5  ...  2.6618200e+5  2.6618300e+5 ││
    ││axis 2│ 2.6661600e+5  2.6661700e+5  ...  2.6662300e+5  2.6662400e+5 │ 2.6662500e+5  2.6662600e+5  ...  2.6663200e+5  2.6663300e+5 │      │ 2.6667000e+5  2.6667100e+5  ...  2.6667700e+5  2.6667800e+5 │ 2.6667900e+5  2.6668000e+5  ...  2.6668600e+5  2.6668700e+5 ││
    ││      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          │      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          ││
    ││      │ 2.7064800e+5  2.7064900e+5  ...  2.7065500e+5  2.7065600e+5 │ 2.7065700e+5  2.7065800e+5  ...  2.7066400e+5  2.7066500e+5 │      │ 2.7070200e+5  2.7070300e+5  ...  2.7070900e+5  2.7071000e+5 │ 2.7071100e+5  2.7071200e+5  ...  2.7071800e+5  2.7071900e+5 ││
    ││      │ 2.7115200e+5  2.7115300e+5  ...  2.7115900e+5  2.7116000e+5 │ 2.7116100e+5  2.7116200e+5  ...  2.7116800e+5  2.7116900e+5 │      │ 2.7120600e+5  2.7120700e+5  ...  2.7121300e+5  2.7121400e+5 │ 2.7121500e+5  2.7121600e+5  ...  2.7122200e+5  2.7122300e+5 ││
    │├──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┤│
    ││9 @ 1 │ 2.7165600e+5  2.7165700e+5  ...  2.7166300e+5  2.7166400e+5 │ 2.7166500e+5  2.7166600e+5  ...  2.7167200e+5  2.7167300e+5 │ ...  │ 2.7171000e+5  2.7171100e+5  ...  2.7171700e+5  2.7171800e+5 │ 2.7171900e+5  2.7172000e+5  ...  2.7172600e+5  2.7172700e+5 ││
    ││axis 2│ 2.7216000e+5  2.7216100e+5  ...  2.7216700e+5  2.7216800e+5 │ 2.7216900e+5  2.7217000e+5  ...  2.7217600e+5  2.7217700e+5 │      │ 2.7221400e+5  2.7221500e+5  ...  2.7222100e+5  2.7222200e+5 │ 2.7222300e+5  2.7222400e+5  ...  2.7223000e+5  2.7223100e+5 ││
    ││      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          │      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          ││
    ││      │ 2.7619200e+5  2.7619300e+5  ...  2.7619900e+5  2.7620000e+5 │ 2.7620100e+5  2.7620200e+5  ...  2.7620800e+5  2.7620900e+5 │      │ 2.7624600e+5  2.7624700e+5  ...  2.7625300e+5  2.7625400e+5 │ 2.7625500e+5  2.7625600e+5  ...  2.7626200e+5  2.7626300e+5 ││
    ││      │ 2.7669600e+5  2.7669700e+5  ...  2.7670300e+5  2.7670400e+5 │ 2.7670500e+5  2.7670600e+5  ...  2.7671200e+5  2.7671300e+5 │      │ 2.7675000e+5  2.7675100e+5  ...  2.7675700e+5  2.7675800e+5 │ 2.7675900e+5  2.7676000e+5  ...  2.7676600e+5  2.7676700e+5 ││
    │└──────┴─────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────┴──────┴─────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────┘│
    ├───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
    │┌──────┬─────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────┬──────┬─────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────┐│
    ││5 @ 0 │0 @ 4                                                        │1 @ 4                                                        │~~~~~ │6 @ 4                                                        │7 @ 4                                                        ││
    ││      │axis 5                                                       │axis 5                                                       │axis 5│axis 5                                                       │axis 5                                                       ││
    │├──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┤│
    ││0 @ 1 │ 2.7720000e+5  2.7720100e+5  ...  2.7720700e+5  2.7720800e+5 │ 2.7720900e+5  2.7721000e+5  ...  2.7721600e+5  2.7721700e+5 │ ...  │ 2.7725400e+5  2.7725500e+5  ...  2.7726100e+5  2.7726200e+5 │ 2.7726300e+5  2.7726400e+5  ...  2.7727000e+5  2.7727100e+5 ││
    ││axis 2│ 2.7770400e+5  2.7770500e+5  ...  2.7771100e+5  2.7771200e+5 │ 2.7771300e+5  2.7771400e+5  ...  2.7772000e+5  2.7772100e+5 │      │ 2.7775800e+5  2.7775900e+5  ...  2.7776500e+5  2.7776600e+5 │ 2.7776700e+5  2.7776800e+5  ...  2.7777400e+5  2.7777500e+5 ││
    ││      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          │      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          ││
    ││      │ 2.8173600e+5  2.8173700e+5  ...  2.8174300e+5  2.8174400e+5 │ 2.8174500e+5  2.8174600e+5  ...  2.8175200e+5  2.8175300e+5 │      │ 2.8179000e+5  2.8179100e+5  ...  2.8179700e+5  2.8179800e+5 │ 2.8179900e+5  2.8180000e+5  ...  2.8180600e+5  2.8180700e+5 ││
    ││      │ 2.8224000e+5  2.8224100e+5  ...  2.8224700e+5  2.8224800e+5 │ 2.8224900e+5  2.8225000e+5  ...  2.8225600e+5  2.8225700e+5 │      │ 2.8229400e+5  2.8229500e+5  ...  2.8230100e+5  2.8230200e+5 │ 2.8230300e+5  2.8230400e+5  ...  2.8231000e+5  2.8231100e+5 ││
    │├──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┤│
    ││1 @ 1 │ 2.8274400e+5  2.8274500e+5  ...  2.8275100e+5  2.8275200e+5 │ 2.8275300e+5  2.8275400e+5  ...  2.8276000e+5  2.8276100e+5 │ ...  │ 2.8279800e+5  2.8279900e+5  ...  2.8280500e+5  2.8280600e+5 │ 2.8280700e+5  2.8280800e+5  ...  2.8281400e+5  2.8281500e+5 ││
    ││axis 2│ 2.8324800e+5  2.8324900e+5  ...  2.8325500e+5  2.8325600e+5 │ 2.8325700e+5  2.8325800e+5  ...  2.8326400e+5  2.8326500e+5 │      │ 2.8330200e+5  2.8330300e+5  ...  2.8330900e+5  2.8331000e+5 │ 2.8331100e+5  2.8331200e+5  ...  2.8331800e+5  2.8331900e+5 ││
    ││      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          │      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          ││
    ││      │ 2.8728000e+5  2.8728100e+5  ...  2.8728700e+5  2.8728800e+5 │ 2.8728900e+5  2.8729000e+5  ...  2.8729600e+5  2.8729700e+5 │      │ 2.8733400e+5  2.8733500e+5  ...  2.8734100e+5  2.8734200e+5 │ 2.8734300e+5  2.8734400e+5  ...  2.8735000e+5  2.8735100e+5 ││
    ││      │ 2.8778400e+5  2.8778500e+5  ...  2.8779100e+5  2.8779200e+5 │ 2.8779300e+5  2.8779400e+5  ...  2.8780000e+5  2.8780100e+5 │      │ 2.8783800e+5  2.8783900e+5  ...  2.8784500e+5  2.8784600e+5 │ 2.8784700e+5  2.8784800e+5  ...  2.8785400e+5  2.8785500e+5 ││
    │├──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┤│
    ││~~~~~ │ ...                                                         │ ...                                                         │ ...  │ ...                                                         │ ...                                                         ││
    ││axis 2│                                                             │                                                             │      │                                                             │                                                             ││
    │├──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┤│
    ││8 @ 1 │ 3.2155200e+5  3.2155300e+5  ...  3.2155900e+5  3.2156000e+5 │ 3.2156100e+5  3.2156200e+5  ...  3.2156800e+5  3.2156900e+5 │ ...  │ 3.2160600e+5  3.2160700e+5  ...  3.2161300e+5  3.2161400e+5 │ 3.2161500e+5  3.2161600e+5  ...  3.2162200e+5  3.2162300e+5 ││
    ││axis 2│ 3.2205600e+5  3.2205700e+5  ...  3.2206300e+5  3.2206400e+5 │ 3.2206500e+5  3.2206600e+5  ...  3.2207200e+5  3.2207300e+5 │      │ 3.2211000e+5  3.2211100e+5  ...  3.2211700e+5  3.2211800e+5 │ 3.2211900e+5  3.2212000e+5  ...  3.2212600e+5  3.2212700e+5 ││
    ││      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          │      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          ││
    ││      │ 3.2608800e+5  3.2608900e+5  ...  3.2609500e+5  3.2609600e+5 │ 3.2609700e+5  3.2609800e+5  ...  3.2610400e+5  3.2610500e+5 │      │ 3.2614200e+5  3.2614300e+5  ...  3.2614900e+5  3.2615000e+5 │ 3.2615100e+5  3.2615200e+5  ...  3.2615800e+5  3.2615900e+5 ││
    ││      │ 3.2659200e+5  3.2659300e+5  ...  3.2659900e+5  3.2660000e+5 │ 3.2660100e+5  3.2660200e+5  ...  3.2660800e+5  3.2660900e+5 │      │ 3.2664600e+5  3.2664700e+5  ...  3.2665300e+5  3.2665400e+5 │ 3.2665500e+5  3.2665600e+5  ...  3.2666200e+5  3.2666300e+5 ││
    │├──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┤│
    ││9 @ 1 │ 3.2709600e+5  3.2709700e+5  ...  3.2710300e+5  3.2710400e+5 │ 3.2710500e+5  3.2710600e+5  ...  3.2711200e+5  3.2711300e+5 │ ...  │ 3.2715000e+5  3.2715100e+5  ...  3.2715700e+5  3.2715800e+5 │ 3.2715900e+5  3.2716000e+5  ...  3.2716600e+5  3.2716700e+5 ││
    ││axis 2│ 3.2760000e+5  3.2760100e+5  ...  3.2760700e+5  3.2760800e+5 │ 3.2760900e+5  3.2761000e+5  ...  3.2761600e+5  3.2761700e+5 │      │ 3.2765400e+5  3.2765500e+5  ...  3.2766100e+5  3.2766200e+5 │ 3.2766300e+5  3.2766400e+5  ...  3.2767000e+5  3.2767100e+5 ││
    ││      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          │      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          ││
    ││      │ 3.3163200e+5  3.3163300e+5  ...  3.3163900e+5  3.3164000e+5 │ 3.3164100e+5  3.3164200e+5  ...  3.3164800e+5  3.3164900e+5 │      │ 3.3168600e+5  3.3168700e+5  ...  3.3169300e+5  3.3169400e+5 │ 3.3169500e+5  3.3169600e+5  ...  3.3170200e+5  3.3170300e+5 ││
    ││      │ 3.3213600e+5  3.3213700e+5  ...  3.3214300e+5  3.3214400e+5 │ 3.3214500e+5  3.3214600e+5  ...  3.3215200e+5  3.3215300e+5 │      │ 3.3219000e+5  3.3219100e+5  ...  3.3219700e+5  3.3219800e+5 │ 3.3219900e+5  3.3220000e+5  ...  3.3220600e+5  3.3220700e+5 ││
    │└──────┴─────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────┴──────┴─────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────┘│
    └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
    |}];
  Tensor.print ~with_code:false ~with_grad:false `Default hoo;
  (* Disable line wrapping for viewing the output. In VSCode: `View: Toggle Word Wrap`. *)
  [%expect
    {|
    ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
    │[6]: -_hoo shape 0:6|1:10,2:11                                                                                                                                                                                                                                         │
    │┌──────┬─────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────┬──────┬─────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────┐│
    ││      │0 @ 0                                                        │1 @ 0                                                        │~~~~~ │4 @ 0                                                        │5 @ 0                                                        ││
    ││      │axis 2                                                       │axis 2                                                       │axis 2│axis 2                                                       │axis 2                                                       ││
    │├──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┤│
    ││axis 1│ 2.5350200e+5  7.6153400e+5  ...  4.8257900e+6  5.3338220e+6 │ 5.6136824e+7  5.6644856e+7  ...  6.0709088e+7  6.1217120e+7 │ ...  │ 2.2378717e+8  2.2429522e+8  ...  2.2835944e+8  2.2886749e+8 │ 2.7967066e+8  2.8017882e+8  ...  2.8424301e+8  2.8475101e+8 ││
    ││      │ 5.8418540e+6  6.3498860e+6  ...  1.0414142e+7  1.0922174e+7 │ 6.1725144e+7  6.2233176e+7  ...  6.6297416e+7  6.6805448e+7 │      │ 2.2937550e+8  2.2988355e+8  ...  2.3394781e+8  2.3445582e+8 │ 2.8525904e+8  2.8576710e+8  ...  2.8983130e+8  2.9033939e+8 ││
    ││      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          │      │ ...           ...           ...  ...           ...          │ ...           ...           ...  ...           ...          ││
    ││      │ 4.4960192e+7  4.5468224e+7  ...  4.9532448e+7  5.0040472e+7 │ 1.0084351e+8  1.0135154e+8  ...  1.0541578e+8  1.0592382e+8 │      │ 2.6849398e+8  2.6900202e+8  ...  2.7306634e+8  2.7357424e+8 │ 3.2437747e+8  3.2488557e+8  ...  3.2894982e+8  3.2945782e+8 ││
    ││      │ 5.0548504e+7  5.1056536e+7  ...  5.5120768e+7  5.5628792e+7 │ 1.0643185e+8  1.0693988e+8  ...  1.1100414e+8  1.1151217e+8 │      │ 2.7408237e+8  2.7459034e+8  ...  2.7865456e+8  2.7916266e+8 │ 3.2996586e+8  3.3047392e+8  ...  3.3453811e+8  3.3504621e+8 ││
    │└──────┴─────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────┴──────┴─────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────┘│
    └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
    |}]
