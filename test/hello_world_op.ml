open Base
open Ocannl
module Tn = Arrayjit.Tnode
module IDX = Train.IDX
module CDSL = Train.CDSL
module TDSL = Operation.TDSL
module Rand = Arrayjit.Rand.Lib

module type Backend = Arrayjit.Backend_intf.Backend

let%expect_test "Hello World" =
  Tensor.unsafe_reinitialize ();
  Stdio.printf "Hello World!\n";
  [%expect {| Hello World! |}]

let%expect_test "Pointwise multiplication dims 1" =
  Tensor.unsafe_reinitialize ();
  let module Backend = (val Arrayjit.Backends.fresh_backend ()) in
  let backend =
    (module Backend : Backend
      with type buffer_ptr = Backend.buffer_ptr
       and type dev = Backend.dev
       and type runner = Backend.runner
       and type event = Backend.event)
  in
  let stream = Backend.(new_stream @@ get_device ~ordinal:0) in
  let ctx = Backend.make_context stream in
  Rand.init 0;
  (* "Hey" is inferred to be a scalar. *)
  let%op y = 2 *. "hey" 7.0 in
  Train.forward_and_forget backend ctx y;

  Tensor.print ~with_code:false ~with_grad:false `Default @@ y;
  [%expect
    {|
    ┌────────────────────┐
    │[3]: *._y shape 0:1 │
    │┌┬────────────────┐ │
    │││axis 0          │ │
    │├┼────────────────┤ │
    │││ 1.400000000e+1 │ │
    │└┴────────────────┘ │
    └────────────────────┘
    |}]

let%expect_test "Matrix multiplication dims 1x1" =
  Tensor.unsafe_reinitialize ();
  let module Backend = (val Arrayjit.Backends.fresh_backend ()) in
  let backend =
    (module Backend : Backend
      with type buffer_ptr = Backend.buffer_ptr
       and type dev = Backend.dev
       and type runner = Backend.runner
       and type event = Backend.event)
  in
  let stream = Backend.(new_stream @@ get_device ~ordinal:0) in
  let ctx = Backend.make_context stream in
  Rand.init 0;
  (* Hey is inferred to be a matrix because of matrix multiplication [*]. *)
  let%op y = ("hey" 7.0 * 'q' 2.0) + 'p' 1.0 in
  Train.forward_and_forget backend ctx y;
  (* Punning for ["hey"] above introduced the [hey] identifier. *)
  Tensor.print ~with_code:false ~with_grad:false `Default @@ hey;
  [%expect
    {|
    ┌────────────────────────┐
    │[0]: hey shape 1:1->0:1 │
    │┌──────┬─────────────┐  │
    ││      │axis 1       │  │
    │├──────┼─────────────┤  │
    ││axis 0│ 7.000000000 │  │
    │└──────┴─────────────┘  │
    └────────────────────────┘
    |}];
  Tensor.print ~with_code:false ~with_grad:false `Default @@ y;
  [%expect
    {|
    ┌───────────────────┐
    │[6]: +_y shape 0:1 │
    │┌┬────────────────┐│
    │││axis 0          ││
    │├┼────────────────┤│
    │││ 1.500000000e+1 ││
    │└┴────────────────┘│
    └───────────────────┘
    |}]

let%expect_test "Print constant tensor" =
  Tensor.unsafe_reinitialize ();
  let module Backend = (val Arrayjit.Backends.fresh_backend ()) in
  let backend =
    (module Backend : Backend
      with type buffer_ptr = Backend.buffer_ptr
       and type dev = Backend.dev
       and type runner = Backend.runner
       and type event = Backend.event)
  in
  let stream = Backend.(new_stream @@ get_device ~ordinal:0) in
  let ctx = Backend.make_context stream in
  Rand.init 0;

  let%op hey = [ (1, 2, 3); (4, 5, 6) ] in
  Train.forward_and_forget backend ctx hey;
  Tensor.print ~with_code:false ~with_grad:false `Inline @@ hey;
  [%expect {|
    [1.000000000, 2.000000000, 3.000000000; 4.000000000, 5.000000000, 6.000000000
      ]
    |}];
  Tensor.print ~with_code:false ~with_grad:false `Default @@ hey;
  [%expect
    {|
    ┌────────────────────────────────────────────────┐
    │[0]: c2x3_hey shape 1:3->0:2                    │
    │┌──────┬───────────────────────────────────────┐│
    ││      │axis 1                                 ││
    │├──────┼───────────────────────────────────────┤│
    ││axis 0│ 1.000000000  2.000000000  3.000000000 ││
    ││      │ 4.000000000  5.000000000  6.000000000 ││
    │└──────┴───────────────────────────────────────┘│
    └────────────────────────────────────────────────┘
    |}];
  let%op hoo = [| [ 1; 2; 3 ]; [ 4; 5; 6 ] |] in
  Train.forward_and_forget backend ctx hoo;
  Tensor.print ~with_code:false ~with_grad:false `Inline @@ hoo;
  [%expect {|
    [|[1.000000000; 2.000000000; 3.000000000];
      [4.000000000; 5.000000000; 6.000000000]|]
    |}];
  Tensor.print ~with_code:false ~with_grad:false `Default @@ hoo;
  [%expect
    {|
    ┌────────────────────────────────────────────────┐
    │[1]: c2x3_hoo shape 0:2|1:3                     │
    │┌──────┬───────────────────────────────────────┐│
    ││      │axis 1                                 ││
    │├──────┼───────────────────────────────────────┤│
    ││axis 0│ 1.000000000  2.000000000  3.000000000 ││
    ││      │ 4.000000000  5.000000000  6.000000000 ││
    │└──────┴───────────────────────────────────────┘│
    └────────────────────────────────────────────────┘
    |}];
  let%op hey2 =
    [
      ((1, 2, 3), (4, 5, 6));
      ((7, 8, 9), (10, 11, 12));
      ((13, 14, 15), (16, 17, 18));
      ((19, 20, 21), (22, 23, 24));
    ]
  in
  Train.forward_and_forget backend ctx hey2;
  Tensor.print ~with_code:false ~with_grad:false `Inline @@ hey2;
  [%expect
    {|
    [
      (1.000000000, 2.000000000, 3.000000000),
        (4.000000000, 5.000000000, 6.000000000);
      (7.000000000, 8.000000000, 9.000000000),
        (10.000000000, 11.000000000, 12.000000000);
      (13.000000000, 14.000000000, 15.000000000),
        (16.000000000, 17.000000000, 18.000000000);
      (19.000000000, 20.000000000, 21.000000000),
        (22.000000000, 23.000000000, 24.000000000)]
    |}];
  Tensor.print ~with_code:false ~with_grad:false `Default @@ hey2;
  [%expect
    {|
    ┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
    │[2]: c4x2x3_hey2 shape 1:2,2:3->0:4                                                                       │
    │┌──────┬────────────────────────────────────────────────┬────────────────────────────────────────────────┐│
    ││      │0 @ 1                                           │1 @ 1                                           ││
    ││      │axis 2                                          │axis 2                                          ││
    │├──────┼────────────────────────────────────────────────┼────────────────────────────────────────────────┤│
    ││axis 0│ 1.000000000     2.000000000     3.000000000    │ 4.000000000     5.000000000     6.000000000    ││
    ││      │ 7.000000000     8.000000000     9.000000000    │ 1.000000000e+1  1.100000000e+1  1.200000000e+1 ││
    ││      │ 1.300000000e+1  1.400000000e+1  1.500000000e+1 │ 1.600000000e+1  1.700000000e+1  1.800000000e+1 ││
    ││      │ 1.900000000e+1  2.000000000e+1  2.100000000e+1 │ 2.200000000e+1  2.300000000e+1  2.400000000e+1 ││
    │└──────┴────────────────────────────────────────────────┴────────────────────────────────────────────────┘│
    └──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
    |}];
  let%op hoo2 =
    [|
      [ [ 1; 2; 3 ]; [ 4; 5; 6 ] ];
      [ [ 7; 8; 9 ]; [ 10; 11; 12 ] ];
      [ [ 13; 14; 15 ]; [ 16; 17; 18 ] ];
      [ [ 19; 20; 21 ]; [ 22; 23; 24 ] ];
    |]
  in
  Train.forward_and_forget backend ctx hoo2;
  Tensor.print ~with_code:false ~with_grad:false `Inline @@ hoo2;
  [%expect
    {|
    [|
      [[1.000000000; 2.000000000; 3.000000000];
        [4.000000000; 5.000000000; 6.000000000]];
      [[7.000000000; 8.000000000; 9.000000000];
        [10.000000000; 11.000000000; 12.000000000]];
      [[13.000000000; 14.000000000; 15.000000000];
        [16.000000000; 17.000000000; 18.000000000]];
      [[19.000000000; 20.000000000; 21.000000000];
        [22.000000000; 23.000000000; 24.000000000]]|]
    |}];
  Tensor.print ~with_code:false ~with_grad:false `Default @@ hoo2;
  [%expect
    {|
    ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
    │[3]: c4x2x3_hoo2 shape 0:4|1:2,2:3                                                                                                                                                                 │
    │┌──────┬───────────────────────────────────────┬────────────────────────────────────────────────┬────────────────────────────────────────────────┬────────────────────────────────────────────────┐│
    ││      │0 @ 0                                  │1 @ 0                                           │2 @ 0                                           │3 @ 0                                           ││
    ││      │axis 2                                 │axis 2                                          │axis 2                                          │axis 2                                          ││
    │├──────┼───────────────────────────────────────┼────────────────────────────────────────────────┼────────────────────────────────────────────────┼────────────────────────────────────────────────┤│
    ││axis 1│ 1.000000000  2.000000000  3.000000000 │ 7.000000000     8.000000000     9.000000000    │ 1.300000000e+1  1.400000000e+1  1.500000000e+1 │ 1.900000000e+1  2.000000000e+1  2.100000000e+1 ││
    ││      │ 4.000000000  5.000000000  6.000000000 │ 1.000000000e+1  1.100000000e+1  1.200000000e+1 │ 1.600000000e+1  1.700000000e+1  1.800000000e+1 │ 2.200000000e+1  2.300000000e+1  2.400000000e+1 ││
    │└──────┴───────────────────────────────────────┴────────────────────────────────────────────────┴────────────────────────────────────────────────┴────────────────────────────────────────────────┘│
    └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
    |}];
  let%op heyhoo =
    [|
      [| [ 1; 2; 3 ]; [ 4; 5; 6 ] |];
      [| [ 7; 8; 9 ]; [ 10; 11; 12 ] |];
      [| [ 13; 14; 15 ]; [ 16; 17; 18 ] |];
      [| [ 19; 20; 21 ]; [ 22; 23; 24 ] |];
    |]
  in
  Train.forward_and_forget backend ctx heyhoo;
  Tensor.print ~with_code:false ~with_grad:false `Inline @@ heyhoo;
  [%expect
    {|
    [|
      [|[1.000000000; 2.000000000; 3.000000000];
        [4.000000000; 5.000000000; 6.000000000]|];
      [|[7.000000000; 8.000000000; 9.000000000];
        [10.000000000; 11.000000000; 12.000000000]|];
      [|[13.000000000; 14.000000000; 15.000000000];
        [16.000000000; 17.000000000; 18.000000000]|];
      [|[19.000000000; 20.000000000; 21.000000000];
        [22.000000000; 23.000000000; 24.000000000]|]|]
    |}];
  Tensor.print ~with_code:false ~with_grad:false `Default @@ heyhoo;
  [%expect
    {|
    ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
    │[4]: c4x2x3_heyhoo shape 0:4,1:2|2:3                                                                                                                                                               │
    │┌──────┬───────────────────────────────────────┬────────────────────────────────────────────────┬────────────────────────────────────────────────┬────────────────────────────────────────────────┐│
    ││      │0 @ 0                                  │1 @ 0                                           │2 @ 0                                           │3 @ 0                                           ││
    ││      │axis 2                                 │axis 2                                          │axis 2                                          │axis 2                                          ││
    │├──────┼───────────────────────────────────────┼────────────────────────────────────────────────┼────────────────────────────────────────────────┼────────────────────────────────────────────────┤│
    ││axis 1│ 1.000000000  2.000000000  3.000000000 │ 7.000000000     8.000000000     9.000000000    │ 1.300000000e+1  1.400000000e+1  1.500000000e+1 │ 1.900000000e+1  2.000000000e+1  2.100000000e+1 ││
    ││      │ 4.000000000  5.000000000  6.000000000 │ 1.000000000e+1  1.100000000e+1  1.200000000e+1 │ 1.600000000e+1  1.700000000e+1  1.800000000e+1 │ 2.200000000e+1  2.300000000e+1  2.400000000e+1 ││
    │└──────┴───────────────────────────────────────┴────────────────────────────────────────────────┴────────────────────────────────────────────────┴────────────────────────────────────────────────┘│
    └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
    |}];
  let%op heyhoo2 =
    [|
      [| [ [ 1; 31 ]; [ 2; 32 ]; [ 3; 33 ] ]; [ [ 4; 34 ]; [ 5; 35 ]; [ 6; 36 ] ] |];
      [| [ [ 7; 37 ]; [ 8; 38 ]; [ 9; 39 ] ]; [ [ 10; 40 ]; [ 11; 41 ]; [ 12; 42 ] ] |];
      [| [ [ 13; 43 ]; [ 14; 44 ]; [ 15; 45 ] ]; [ [ 16; 46 ]; [ 17; 47 ]; [ 18; 48 ] ] |];
      [| [ [ 19; 49 ]; [ 20; 50 ]; [ 21; 51 ] ]; [ [ 22; 52 ]; [ 23; 53 ]; [ 24; 54 ] ] |];
    |]
  in
  Train.forward_and_forget backend ctx heyhoo2;
  Tensor.print ~with_code:false ~with_grad:false `Inline @@ heyhoo2;
  [%expect
    {|
    [|
      [|
        [[1.000000000; 31.000000000]; [2.000000000; 32.000000000];
          [3.000000000; 33.000000000]];
        [[4.000000000; 34.000000000]; [5.000000000; 35.000000000];
          [6.000000000; 36.000000000]]|];
      [|
        [[7.000000000; 37.000000000]; [8.000000000; 38.000000000];
          [9.000000000; 39.000000000]];
        [[10.000000000; 40.000000000]; [11.000000000; 41.000000000];
          [12.000000000; 42.000000000]]|];
      [|
        [[13.000000000; 43.000000000]; [14.000000000; 44.000000000];
          [15.000000000; 45.000000000]];
        [[16.000000000; 46.000000000]; [17.000000000; 47.000000000];
          [18.000000000; 48.000000000]]|];
      [|
        [[19.000000000; 49.000000000]; [20.000000000; 50.000000000];
          [21.000000000; 51.000000000]];
        [[22.000000000; 52.000000000]; [23.000000000; 53.000000000];
          [24.000000000; 54.000000000]]|]|]
    |}];
  Tensor.print ~with_code:false ~with_grad:false `Default @@ heyhoo2;
  [%expect
    {|
    ┌──────────────────────────────────────────────────────────────────────────┐
    │[5]: c4x2x3x2_heyhoo2 shape 0:4,1:2|2:3,3:2                               │
    │┌──────┬────────────────────────────────┬────────────────────────────────┐│
    ││      │0 @ 1                           │1 @ 1                           ││
    ││      │axis 3                          │axis 3                          ││
    │├──────┼────────────────────────────────┼────────────────────────────────┤│
    ││0 @ 0 │ 1.000000000  3.100000000e+1    │ 4.000000000  3.400000000e+1    ││
    ││axis 2│ 2.000000000  3.200000000e+1    │ 5.000000000  3.500000000e+1    ││
    ││      │ 3.000000000  3.300000000e+1    │ 6.000000000  3.600000000e+1    ││
    │├──────┼────────────────────────────────┼────────────────────────────────┤│
    ││1 @ 0 │ 7.000000000  3.700000000e+1    │ 1.000000000e+1  4.000000000e+1 ││
    ││axis 2│ 8.000000000  3.800000000e+1    │ 1.100000000e+1  4.100000000e+1 ││
    ││      │ 9.000000000  3.900000000e+1    │ 1.200000000e+1  4.200000000e+1 ││
    │├──────┼────────────────────────────────┼────────────────────────────────┤│
    ││2 @ 0 │ 1.300000000e+1  4.300000000e+1 │ 1.600000000e+1  4.600000000e+1 ││
    ││axis 2│ 1.400000000e+1  4.400000000e+1 │ 1.700000000e+1  4.700000000e+1 ││
    ││      │ 1.500000000e+1  4.500000000e+1 │ 1.800000000e+1  4.800000000e+1 ││
    │├──────┼────────────────────────────────┼────────────────────────────────┤│
    ││3 @ 0 │ 1.900000000e+1  4.900000000e+1 │ 2.200000000e+1  5.200000000e+1 ││
    ││axis 2│ 2.000000000e+1  5.000000000e+1 │ 2.300000000e+1  5.300000000e+1 ││
    ││      │ 2.100000000e+1  5.100000000e+1 │ 2.400000000e+1  5.400000000e+1 ││
    │└──────┴────────────────────────────────┴────────────────────────────────┘│
    └──────────────────────────────────────────────────────────────────────────┘
    |}];
  let%op heyhoo3 =
    [|
      [|
        [ [ [ 1; 31 ]; [ 2; 32 ]; [ 3; 33 ] ]; [ [ 4; 34 ]; [ 5; 35 ]; [ 6; 36 ] ] ];
        [ [ [ 7; 37 ]; [ 8; 38 ]; [ 9; 39 ] ]; [ [ 10; 40 ]; [ 11; 41 ]; [ 12; 42 ] ] ];
      |];
      [|
        [ [ [ 13; 43 ]; [ 14; 44 ]; [ 15; 45 ] ]; [ [ 16; 46 ]; [ 17; 47 ]; [ 18; 48 ] ] ];
        [ [ [ 19; 49 ]; [ 20; 50 ]; [ 21; 51 ] ]; [ [ 22; 52 ]; [ 23; 53 ]; [ 24; 54 ] ] ];
      |];
    |]
  in
  Train.forward_and_forget backend ctx heyhoo3;
  Tensor.print ~with_code:false ~with_grad:false `Inline @@ heyhoo3;
  [%expect
    {|
    [|
      [|
        [
          [[1.000000000; 31.000000000]; [2.000000000; 32.000000000];
            [3.000000000; 33.000000000]];
          [[4.000000000; 34.000000000]; [5.000000000; 35.000000000];
            [6.000000000; 36.000000000]]];
        [
          [[7.000000000; 37.000000000]; [8.000000000; 38.000000000];
            [9.000000000; 39.000000000]];
          [[10.000000000; 40.000000000]; [11.000000000; 41.000000000];
            [12.000000000; 42.000000000]]]|];
      [|
        [
          [[13.000000000; 43.000000000]; [14.000000000; 44.000000000];
            [15.000000000; 45.000000000]];
          [[16.000000000; 46.000000000]; [17.000000000; 47.000000000];
            [18.000000000; 48.000000000]]];
        [
          [[19.000000000; 49.000000000]; [20.000000000; 50.000000000];
            [21.000000000; 51.000000000]];
          [[22.000000000; 52.000000000]; [23.000000000; 53.000000000];
            [24.000000000; 54.000000000]]]|]|]
    |}];
  Tensor.print ~with_code:false ~with_grad:false `Default @@ heyhoo3;
  [%expect
    {|
    ┌──────────────────────────────────────────────────────────────────────────┐
    │[6]: c2x2x2x3x2_heyhoo3 shape 0:2,1:2|2:2,3:3,4:2                         │
    │┌──────┬─────────────────────────────┬────────────────────────────────┐   │
    ││0 @ 0 │0 @ 2                        │1 @ 2                           │   │
    ││      │axis 4                       │axis 4                          │   │
    │├──────┼─────────────────────────────┼────────────────────────────────┤   │
    ││0 @ 1 │ 1.000000000  3.100000000e+1 │ 4.000000000  3.400000000e+1    │   │
    ││axis 3│ 2.000000000  3.200000000e+1 │ 5.000000000  3.500000000e+1    │   │
    ││      │ 3.000000000  3.300000000e+1 │ 6.000000000  3.600000000e+1    │   │
    │├──────┼─────────────────────────────┼────────────────────────────────┤   │
    ││1 @ 1 │ 7.000000000  3.700000000e+1 │ 1.000000000e+1  4.000000000e+1 │   │
    ││axis 3│ 8.000000000  3.800000000e+1 │ 1.100000000e+1  4.100000000e+1 │   │
    ││      │ 9.000000000  3.900000000e+1 │ 1.200000000e+1  4.200000000e+1 │   │
    │└──────┴─────────────────────────────┴────────────────────────────────┘   │
    ├──────────────────────────────────────────────────────────────────────────┤
    │┌──────┬────────────────────────────────┬────────────────────────────────┐│
    ││1 @ 0 │0 @ 2                           │1 @ 2                           ││
    ││      │axis 4                          │axis 4                          ││
    │├──────┼────────────────────────────────┼────────────────────────────────┤│
    ││0 @ 1 │ 1.300000000e+1  4.300000000e+1 │ 1.600000000e+1  4.600000000e+1 ││
    ││axis 3│ 1.400000000e+1  4.400000000e+1 │ 1.700000000e+1  4.700000000e+1 ││
    ││      │ 1.500000000e+1  4.500000000e+1 │ 1.800000000e+1  4.800000000e+1 ││
    │├──────┼────────────────────────────────┼────────────────────────────────┤│
    ││1 @ 1 │ 1.900000000e+1  4.900000000e+1 │ 2.200000000e+1  5.200000000e+1 ││
    ││axis 3│ 2.000000000e+1  5.000000000e+1 │ 2.300000000e+1  5.300000000e+1 ││
    ││      │ 2.100000000e+1  5.100000000e+1 │ 2.400000000e+1  5.400000000e+1 ││
    │└──────┴────────────────────────────────┴────────────────────────────────┘│
    └──────────────────────────────────────────────────────────────────────────┘
    |}];
  let%op heyhoo4 =
    [|
      [
        [ [ (1, 31); (2, 32); (3, 33) ]; [ (4, 34); (5, 35); (6, 36) ] ];
        [ [ (7, 37); (8, 38); (9, 39) ]; [ (10, 40); (11, 41); (12, 42) ] ];
      ];
      [
        [ [ (13, 43); (14, 44); (15, 45) ]; [ (16, 46); (17, 47); (18, 48) ] ];
        [ [ (19, 49); (20, 50); (21, 51) ]; [ (22, 52); (23, 53); (24, 54) ] ];
      ];
    |]
  in
  Train.forward_and_forget backend ctx heyhoo4;
  Tensor.print ~with_code:false ~with_grad:false `Inline @@ heyhoo4;
  [%expect
    {|
    [|
      [
        [
          [1.000000000, 31.000000000; 2.000000000, 32.000000000;
            3.000000000, 33.000000000];
          [4.000000000, 34.000000000; 5.000000000, 35.000000000;
            6.000000000, 36.000000000]];
        [
          [7.000000000, 37.000000000; 8.000000000, 38.000000000;
            9.000000000, 39.000000000];
          [10.000000000, 40.000000000; 11.000000000, 41.000000000;
            12.000000000, 42.000000000]]];
      [
        [
          [13.000000000, 43.000000000; 14.000000000, 44.000000000;
            15.000000000, 45.000000000];
          [16.000000000, 46.000000000; 17.000000000, 47.000000000;
            18.000000000, 48.000000000]];
        [
          [19.000000000, 49.000000000; 20.000000000, 50.000000000;
            21.000000000, 51.000000000];
          [22.000000000, 52.000000000; 23.000000000, 53.000000000;
            24.000000000, 54.000000000]]]|]
    |}];
  Tensor.print ~with_code:false ~with_grad:false `Default @@ heyhoo4;
  [%expect
    {|
    ┌──────────────────────────────────────────────────────────────────────────┐
    │[7]: c2x2x2x3x2_heyhoo4 shape 0:2|4:2->1:2,2:2,3:3                        │
    │┌──────┬─────────────────────────────┬────────────────────────────────┐   │
    ││0 @ 0 │0 @ 2                        │1 @ 2                           │   │
    ││      │axis 4                       │axis 4                          │   │
    │├──────┼─────────────────────────────┼────────────────────────────────┤   │
    ││0 @ 1 │ 1.000000000  3.100000000e+1 │ 4.000000000  3.400000000e+1    │   │
    ││axis 3│ 2.000000000  3.200000000e+1 │ 5.000000000  3.500000000e+1    │   │
    ││      │ 3.000000000  3.300000000e+1 │ 6.000000000  3.600000000e+1    │   │
    │├──────┼─────────────────────────────┼────────────────────────────────┤   │
    ││1 @ 1 │ 7.000000000  3.700000000e+1 │ 1.000000000e+1  4.000000000e+1 │   │
    ││axis 3│ 8.000000000  3.800000000e+1 │ 1.100000000e+1  4.100000000e+1 │   │
    ││      │ 9.000000000  3.900000000e+1 │ 1.200000000e+1  4.200000000e+1 │   │
    │└──────┴─────────────────────────────┴────────────────────────────────┘   │
    ├──────────────────────────────────────────────────────────────────────────┤
    │┌──────┬────────────────────────────────┬────────────────────────────────┐│
    ││1 @ 0 │0 @ 2                           │1 @ 2                           ││
    ││      │axis 4                          │axis 4                          ││
    │├──────┼────────────────────────────────┼────────────────────────────────┤│
    ││0 @ 1 │ 1.300000000e+1  4.300000000e+1 │ 1.600000000e+1  4.600000000e+1 ││
    ││axis 3│ 1.400000000e+1  4.400000000e+1 │ 1.700000000e+1  4.700000000e+1 ││
    ││      │ 1.500000000e+1  4.500000000e+1 │ 1.800000000e+1  4.800000000e+1 ││
    │├──────┼────────────────────────────────┼────────────────────────────────┤│
    ││1 @ 1 │ 1.900000000e+1  4.900000000e+1 │ 2.200000000e+1  5.200000000e+1 ││
    ││axis 3│ 2.000000000e+1  5.000000000e+1 │ 2.300000000e+1  5.300000000e+1 ││
    ││      │ 2.100000000e+1  5.100000000e+1 │ 2.400000000e+1  5.400000000e+1 ││
    │└──────┴────────────────────────────────┴────────────────────────────────┘│
    └──────────────────────────────────────────────────────────────────────────┘
    |}]

let%expect_test "Matrix multiplication dims 2x3" =
  Tensor.unsafe_reinitialize ();
  let module Backend = (val Arrayjit.Backends.fresh_backend ()) in
  let backend =
    (module Backend : Backend
      with type buffer_ptr = Backend.buffer_ptr
       and type dev = Backend.dev
       and type runner = Backend.runner
       and type event = Backend.event)
  in
  let stream = Backend.(new_stream @@ get_device ~ordinal:0) in
  let ctx = Backend.make_context stream in
  Rand.init 0;
  (* Hey is inferred to be a matrix. *)
  let%op y = ("hey" 7.0 * [ 2; 3 ]) + [ 4; 5; 6 ] in
  Train.forward_and_forget backend ctx y;
  Tensor.print ~with_code:false ~with_grad:false `Default @@ hey;
  [%expect
    {|
    ┌───────────────────────────────────┐
    │[0]: hey shape 1:2->0:3            │
    │┌──────┬──────────────────────────┐│
    ││      │axis 1                    ││
    │├──────┼──────────────────────────┤│
    ││axis 0│ 7.000000000  7.000000000 ││
    ││      │ 7.000000000  7.000000000 ││
    ││      │ 7.000000000  7.000000000 ││
    │└──────┴──────────────────────────┘│
    └───────────────────────────────────┘
    |}];
  Tensor.print ~with_code:false ~with_grad:false `Default @@ y;
  [%expect
    {|
    ┌───────────────────────────────────────────────────┐
    │[6]: +_y shape 0:3                                 │
    │┌┬────────────────────────────────────────────────┐│
    │││axis 0                                          ││
    │├┼────────────────────────────────────────────────┤│
    │││ 3.900000000e+1  4.000000000e+1  4.100000000e+1 ││
    │└┴────────────────────────────────────────────────┘│
    └───────────────────────────────────────────────────┘
    |}]

let%expect_test "Big matrix" =
  Tensor.unsafe_reinitialize ();
  let module Backend = (val Arrayjit.Backends.fresh_backend ()) in
  let backend =
    (module Backend : Backend
      with type buffer_ptr = Backend.buffer_ptr
       and type dev = Backend.dev
       and type runner = Backend.runner
       and type event = Backend.event)
  in
  let stream = Backend.(new_stream @@ get_device ~ordinal:0) in
  let ctx = Backend.make_context stream in
  Rand.init 0;
  (* Hey is inferred to be a matrix. *)
  let hey = Tensor.param ~values:[| 0.5 |] "hey" in
  let zero_to_twenty = TDSL.range 20 in
  let y = TDSL.O.((hey * zero_to_twenty) + zero_to_twenty) in
  Train.forward_and_forget backend ctx y;
  Tensor.print ~with_code:false ~with_grad:false `Inline zero_to_twenty;
  [%expect
    {|
    [0.000000000; 1.000000000; 2.000000000; 3.000000000; 4.000000000;
      5.000000000; 6.000000000; 7.000000000; 8.000000000; 9.000000000;
      10.000000000; 11.000000000; 12.000000000; 13.000000000; 14.000000000;
      15.000000000; 16.000000000; 17.000000000; 18.000000000; 19.000000000;
      20.000000000]
    |}];
  Tensor.print ~with_code:false ~with_grad:false `Default zero_to_twenty;
  [%expect
    {|
    ┌──────────────────────────────────────────────────────────────────┐
    │[2]: 0...20 shape 0:21                                            │
    │┌┬───────────────────────────────────────────────────────────────┐│
    │││axis 0                                                         ││
    │├┼───────────────────────────────────────────────────────────────┤│
    │││ 0.000000000  1.000000000  ...  1.900000000e+1  2.000000000e+1 ││
    │└┴───────────────────────────────────────────────────────────────┘│
    └──────────────────────────────────────────────────────────────────┘
    |}];
  Tensor.print ~with_code:false ~with_grad:false `Default hey;
  [%expect
    {|
    ┌──────────────────────────────────────────────────────────────────────────────┐
    │[0]: hey shape 1:21->0:21                                                     │
    │┌──────┬─────────────────────────────────────────────────────────────────────┐│
    ││      │axis 1                                                               ││
    │├──────┼─────────────────────────────────────────────────────────────────────┤│
    ││axis 0│ 5.000000000e-1  5.000000000e-1  ...  5.000000000e-1  5.000000000e-1 ││
    ││      │ 5.000000000e-1  5.000000000e-1  ...  5.000000000e-1  5.000000000e-1 ││
    ││      │ ...             ...             ...  ...             ...            ││
    ││      │ 5.000000000e-1  5.000000000e-1  ...  5.000000000e-1  5.000000000e-1 ││
    ││      │ 5.000000000e-1  5.000000000e-1  ...  5.000000000e-1  5.000000000e-1 ││
    │└──────┴─────────────────────────────────────────────────────────────────────┘│
    └──────────────────────────────────────────────────────────────────────────────┘
    |}];
  Tensor.print ~with_code:false ~with_grad:false `Default y;
  [%expect
    {|
    ┌────────────────────────────────────────────────────────────────────────┐
    │[5]: + shape 0:21                                                       │
    │┌┬─────────────────────────────────────────────────────────────────────┐│
    │││axis 0                                                               ││
    │├┼─────────────────────────────────────────────────────────────────────┤│
    │││ 1.050000000e+2  1.060000000e+2  ...  1.240000000e+2  1.250000000e+2 ││
    │└┴─────────────────────────────────────────────────────────────────────┘│
    └────────────────────────────────────────────────────────────────────────┘
    |}]

let%expect_test "Very big tensor" =
  Tensor.unsafe_reinitialize ();
  let module Backend = (val Arrayjit.Backends.fresh_backend ()) in
  let backend =
    (module Backend : Backend
      with type buffer_ptr = Backend.buffer_ptr
       and type dev = Backend.dev
       and type runner = Backend.runner
       and type event = Backend.event)
  in
  let stream = Backend.(new_stream @@ get_device ~ordinal:0) in
  let ctx = Backend.make_context stream in
  Rand.init 0;
  let hey =
    TDSL.range_of_shape ~batch_dims:[ 6 ] ~input_dims:[ 7; 8; 9 ] ~output_dims:[ 10; 11 ] ()
  in
  let%op hoo = (hey * (1 + 1)) - 10 in
  Train.forward_and_forget backend ctx hoo;
  Tensor.print ~with_code:false ~with_grad:false `Default hey;
  [%expect
    {|
    ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
    │[0]: r6x10x11x7x8x9 shape 0:6|3:7,4:8,5:9->1:10,2:11                                                                                                                                                                                                                                                   │
    │┌──────┬─────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────┬──────┬─────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────┐│
    ││0 @ 0 │0 @ 4                                                                │1 @ 4                                                                │~~~~~ │6 @ 4                                                                │7 @ 4                                                                ││
    ││      │axis 5                                                               │axis 5                                                               │axis 5│axis 5                                                               │axis 5                                                               ││
    │├──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┤│
    ││0 @ 1 │ 0.000000000     1.000000000     ...  7.000000000     8.000000000    │ 9.000000000     1.000000000e+1  ...  1.600000000e+1  1.700000000e+1 │ ...  │ 5.400000000e+1  5.500000000e+1  ...  6.100000000e+1  6.200000000e+1 │ 6.300000000e+1  6.400000000e+1  ...  7.000000000e+1  7.100000000e+1 ││
    ││axis 2│ 5.040000000e+2  5.050000000e+2  ...  5.110000000e+2  5.120000000e+2 │ 5.130000000e+2  5.140000000e+2  ...  5.200000000e+2  5.210000000e+2 │      │ 5.580000000e+2  5.590000000e+2  ...  5.650000000e+2  5.660000000e+2 │ 5.670000000e+2  5.680000000e+2  ...  5.740000000e+2  5.750000000e+2 ││
    ││      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            │      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            ││
    ││      │ 4.536000000e+3  4.537000000e+3  ...  4.543000000e+3  4.544000000e+3 │ 4.545000000e+3  4.546000000e+3  ...  4.552000000e+3  4.553000000e+3 │      │ 4.590000000e+3  4.591000000e+3  ...  4.597000000e+3  4.598000000e+3 │ 4.599000000e+3  4.600000000e+3  ...  4.606000000e+3  4.607000000e+3 ││
    ││      │ 5.040000000e+3  5.041000000e+3  ...  5.047000000e+3  5.048000000e+3 │ 5.049000000e+3  5.050000000e+3  ...  5.056000000e+3  5.057000000e+3 │      │ 5.094000000e+3  5.095000000e+3  ...  5.101000000e+3  5.102000000e+3 │ 5.103000000e+3  5.104000000e+3  ...  5.110000000e+3  5.111000000e+3 ││
    │├──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┤│
    ││1 @ 1 │ 5.544000000e+3  5.545000000e+3  ...  5.551000000e+3  5.552000000e+3 │ 5.553000000e+3  5.554000000e+3  ...  5.560000000e+3  5.561000000e+3 │ ...  │ 5.598000000e+3  5.599000000e+3  ...  5.605000000e+3  5.606000000e+3 │ 5.607000000e+3  5.608000000e+3  ...  5.614000000e+3  5.615000000e+3 ││
    ││axis 2│ 6.048000000e+3  6.049000000e+3  ...  6.055000000e+3  6.056000000e+3 │ 6.057000000e+3  6.058000000e+3  ...  6.064000000e+3  6.065000000e+3 │      │ 6.102000000e+3  6.103000000e+3  ...  6.109000000e+3  6.110000000e+3 │ 6.111000000e+3  6.112000000e+3  ...  6.118000000e+3  6.119000000e+3 ││
    ││      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            │      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            ││
    ││      │ 1.008000000e+4  1.008100000e+4  ...  1.008700000e+4  1.008800000e+4 │ 1.008900000e+4  1.009000000e+4  ...  1.009600000e+4  1.009700000e+4 │      │ 1.013400000e+4  1.013500000e+4  ...  1.014100000e+4  1.014200000e+4 │ 1.014300000e+4  1.014400000e+4  ...  1.015000000e+4  1.015100000e+4 ││
    ││      │ 1.058400000e+4  1.058500000e+4  ...  1.059100000e+4  1.059200000e+4 │ 1.059300000e+4  1.059400000e+4  ...  1.060000000e+4  1.060100000e+4 │      │ 1.063800000e+4  1.063900000e+4  ...  1.064500000e+4  1.064600000e+4 │ 1.064700000e+4  1.064800000e+4  ...  1.065400000e+4  1.065500000e+4 ││
    │├──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┤│
    ││~~~~~ │ ...                                                                 │ ...                                                                 │ ...  │ ...                                                                 │ ...                                                                 ││
    ││axis 2│                                                                     │                                                                     │      │                                                                     │                                                                     ││
    │├──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┤│
    ││8 @ 1 │ 4.435200000e+4  4.435300000e+4  ...  4.435900000e+4  4.436000000e+4 │ 4.436100000e+4  4.436200000e+4  ...  4.436800000e+4  4.436900000e+4 │ ...  │ 4.440600000e+4  4.440700000e+4  ...  4.441300000e+4  4.441400000e+4 │ 4.441500000e+4  4.441600000e+4  ...  4.442200000e+4  4.442300000e+4 ││
    ││axis 2│ 4.485600000e+4  4.485700000e+4  ...  4.486300000e+4  4.486400000e+4 │ 4.486500000e+4  4.486600000e+4  ...  4.487200000e+4  4.487300000e+4 │      │ 4.491000000e+4  4.491100000e+4  ...  4.491700000e+4  4.491800000e+4 │ 4.491900000e+4  4.492000000e+4  ...  4.492600000e+4  4.492700000e+4 ││
    ││      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            │      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            ││
    ││      │ 4.888800000e+4  4.888900000e+4  ...  4.889500000e+4  4.889600000e+4 │ 4.889700000e+4  4.889800000e+4  ...  4.890400000e+4  4.890500000e+4 │      │ 4.894200000e+4  4.894300000e+4  ...  4.894900000e+4  4.895000000e+4 │ 4.895100000e+4  4.895200000e+4  ...  4.895800000e+4  4.895900000e+4 ││
    ││      │ 4.939200000e+4  4.939300000e+4  ...  4.939900000e+4  4.940000000e+4 │ 4.940100000e+4  4.940200000e+4  ...  4.940800000e+4  4.940900000e+4 │      │ 4.944600000e+4  4.944700000e+4  ...  4.945300000e+4  4.945400000e+4 │ 4.945500000e+4  4.945600000e+4  ...  4.946200000e+4  4.946300000e+4 ││
    │├──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┤│
    ││9 @ 1 │ 4.989600000e+4  4.989700000e+4  ...  4.990300000e+4  4.990400000e+4 │ 4.990500000e+4  4.990600000e+4  ...  4.991200000e+4  4.991300000e+4 │ ...  │ 4.995000000e+4  4.995100000e+4  ...  4.995700000e+4  4.995800000e+4 │ 4.995900000e+4  4.996000000e+4  ...  4.996600000e+4  4.996700000e+4 ││
    ││axis 2│ 5.040000000e+4  5.040100000e+4  ...  5.040700000e+4  5.040800000e+4 │ 5.040900000e+4  5.041000000e+4  ...  5.041600000e+4  5.041700000e+4 │      │ 5.045400000e+4  5.045500000e+4  ...  5.046100000e+4  5.046200000e+4 │ 5.046300000e+4  5.046400000e+4  ...  5.047000000e+4  5.047100000e+4 ││
    ││      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            │      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            ││
    ││      │ 5.443200000e+4  5.443300000e+4  ...  5.443900000e+4  5.444000000e+4 │ 5.444100000e+4  5.444200000e+4  ...  5.444800000e+4  5.444900000e+4 │      │ 5.448600000e+4  5.448700000e+4  ...  5.449300000e+4  5.449400000e+4 │ 5.449500000e+4  5.449600000e+4  ...  5.450200000e+4  5.450300000e+4 ││
    ││      │ 5.493600000e+4  5.493700000e+4  ...  5.494300000e+4  5.494400000e+4 │ 5.494500000e+4  5.494600000e+4  ...  5.495200000e+4  5.495300000e+4 │      │ 5.499000000e+4  5.499100000e+4  ...  5.499700000e+4  5.499800000e+4 │ 5.499900000e+4  5.500000000e+4  ...  5.500600000e+4  5.500700000e+4 ││
    │└──────┴─────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────┴──────┴─────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────┘│
    ├───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
    │┌──────┬─────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────┬──────┬─────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────┐│
    ││1 @ 0 │0 @ 4                                                                │1 @ 4                                                                │~~~~~ │6 @ 4                                                                │7 @ 4                                                                ││
    ││      │axis 5                                                               │axis 5                                                               │axis 5│axis 5                                                               │axis 5                                                               ││
    │├──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┤│
    ││0 @ 1 │ 5.544000000e+4  5.544100000e+4  ...  5.544700000e+4  5.544800000e+4 │ 5.544900000e+4  5.545000000e+4  ...  5.545600000e+4  5.545700000e+4 │ ...  │ 5.549400000e+4  5.549500000e+4  ...  5.550100000e+4  5.550200000e+4 │ 5.550300000e+4  5.550400000e+4  ...  5.551000000e+4  5.551100000e+4 ││
    ││axis 2│ 5.594400000e+4  5.594500000e+4  ...  5.595100000e+4  5.595200000e+4 │ 5.595300000e+4  5.595400000e+4  ...  5.596000000e+4  5.596100000e+4 │      │ 5.599800000e+4  5.599900000e+4  ...  5.600500000e+4  5.600600000e+4 │ 5.600700000e+4  5.600800000e+4  ...  5.601400000e+4  5.601500000e+4 ││
    ││      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            │      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            ││
    ││      │ 5.997600000e+4  5.997700000e+4  ...  5.998300000e+4  5.998400000e+4 │ 5.998500000e+4  5.998600000e+4  ...  5.999200000e+4  5.999300000e+4 │      │ 6.003000000e+4  6.003100000e+4  ...  6.003700000e+4  6.003800000e+4 │ 6.003900000e+4  6.004000000e+4  ...  6.004600000e+4  6.004700000e+4 ││
    ││      │ 6.048000000e+4  6.048100000e+4  ...  6.048700000e+4  6.048800000e+4 │ 6.048900000e+4  6.049000000e+4  ...  6.049600000e+4  6.049700000e+4 │      │ 6.053400000e+4  6.053500000e+4  ...  6.054100000e+4  6.054200000e+4 │ 6.054300000e+4  6.054400000e+4  ...  6.055000000e+4  6.055100000e+4 ││
    │├──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┤│
    ││1 @ 1 │ 6.098400000e+4  6.098500000e+4  ...  6.099100000e+4  6.099200000e+4 │ 6.099300000e+4  6.099400000e+4  ...  6.100000000e+4  6.100100000e+4 │ ...  │ 6.103800000e+4  6.103900000e+4  ...  6.104500000e+4  6.104600000e+4 │ 6.104700000e+4  6.104800000e+4  ...  6.105400000e+4  6.105500000e+4 ││
    ││axis 2│ 6.148800000e+4  6.148900000e+4  ...  6.149500000e+4  6.149600000e+4 │ 6.149700000e+4  6.149800000e+4  ...  6.150400000e+4  6.150500000e+4 │      │ 6.154200000e+4  6.154300000e+4  ...  6.154900000e+4  6.155000000e+4 │ 6.155100000e+4  6.155200000e+4  ...  6.155800000e+4  6.155900000e+4 ││
    ││      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            │      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            ││
    ││      │ 6.552000000e+4  6.552100000e+4  ...  6.552700000e+4  6.552800000e+4 │ 6.552900000e+4  6.553000000e+4  ...  6.553600000e+4  6.553700000e+4 │      │ 6.557400000e+4  6.557500000e+4  ...  6.558100000e+4  6.558200000e+4 │ 6.558300000e+4  6.558400000e+4  ...  6.559000000e+4  6.559100000e+4 ││
    ││      │ 6.602400000e+4  6.602500000e+4  ...  6.603100000e+4  6.603200000e+4 │ 6.603300000e+4  6.603400000e+4  ...  6.604000000e+4  6.604100000e+4 │      │ 6.607800000e+4  6.607900000e+4  ...  6.608500000e+4  6.608600000e+4 │ 6.608700000e+4  6.608800000e+4  ...  6.609400000e+4  6.609500000e+4 ││
    │├──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┤│
    ││~~~~~ │ ...                                                                 │ ...                                                                 │ ...  │ ...                                                                 │ ...                                                                 ││
    ││axis 2│                                                                     │                                                                     │      │                                                                     │                                                                     ││
    │├──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┤│
    ││8 @ 1 │ 9.979200000e+4  9.979300000e+4  ...  9.979900000e+4  9.980000000e+4 │ 9.980100000e+4  9.980200000e+4  ...  9.980800000e+4  9.980900000e+4 │ ...  │ 9.984600000e+4  9.984700000e+4  ...  9.985300000e+4  9.985400000e+4 │ 9.985500000e+4  9.985600000e+4  ...  9.986200000e+4  9.986300000e+4 ││
    ││axis 2│ 1.002960000e+5  1.002970000e+5  ...  1.003030000e+5  1.003040000e+5 │ 1.003050000e+5  1.003060000e+5  ...  1.003120000e+5  1.003130000e+5 │      │ 1.003500000e+5  1.003510000e+5  ...  1.003570000e+5  1.003580000e+5 │ 1.003590000e+5  1.003600000e+5  ...  1.003660000e+5  1.003670000e+5 ││
    ││      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            │      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            ││
    ││      │ 1.043280000e+5  1.043290000e+5  ...  1.043350000e+5  1.043360000e+5 │ 1.043370000e+5  1.043380000e+5  ...  1.043440000e+5  1.043450000e+5 │      │ 1.043820000e+5  1.043830000e+5  ...  1.043890000e+5  1.043900000e+5 │ 1.043910000e+5  1.043920000e+5  ...  1.043980000e+5  1.043990000e+5 ││
    ││      │ 1.048320000e+5  1.048330000e+5  ...  1.048390000e+5  1.048400000e+5 │ 1.048410000e+5  1.048420000e+5  ...  1.048480000e+5  1.048490000e+5 │      │ 1.048860000e+5  1.048870000e+5  ...  1.048930000e+5  1.048940000e+5 │ 1.048950000e+5  1.048960000e+5  ...  1.049020000e+5  1.049030000e+5 ││
    │├──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┤│
    ││9 @ 1 │ 1.053360000e+5  1.053370000e+5  ...  1.053430000e+5  1.053440000e+5 │ 1.053450000e+5  1.053460000e+5  ...  1.053520000e+5  1.053530000e+5 │ ...  │ 1.053900000e+5  1.053910000e+5  ...  1.053970000e+5  1.053980000e+5 │ 1.053990000e+5  1.054000000e+5  ...  1.054060000e+5  1.054070000e+5 ││
    ││axis 2│ 1.058400000e+5  1.058410000e+5  ...  1.058470000e+5  1.058480000e+5 │ 1.058490000e+5  1.058500000e+5  ...  1.058560000e+5  1.058570000e+5 │      │ 1.058940000e+5  1.058950000e+5  ...  1.059010000e+5  1.059020000e+5 │ 1.059030000e+5  1.059040000e+5  ...  1.059100000e+5  1.059110000e+5 ││
    ││      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            │      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            ││
    ││      │ 1.098720000e+5  1.098730000e+5  ...  1.098790000e+5  1.098800000e+5 │ 1.098810000e+5  1.098820000e+5  ...  1.098880000e+5  1.098890000e+5 │      │ 1.099260000e+5  1.099270000e+5  ...  1.099330000e+5  1.099340000e+5 │ 1.099350000e+5  1.099360000e+5  ...  1.099420000e+5  1.099430000e+5 ││
    ││      │ 1.103760000e+5  1.103770000e+5  ...  1.103830000e+5  1.103840000e+5 │ 1.103850000e+5  1.103860000e+5  ...  1.103920000e+5  1.103930000e+5 │      │ 1.104300000e+5  1.104310000e+5  ...  1.104370000e+5  1.104380000e+5 │ 1.104390000e+5  1.104400000e+5  ...  1.104460000e+5  1.104470000e+5 ││
    │└──────┴─────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────┴──────┴─────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────┘│
    ├───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
    │ ...                                                                                                                                                                                                                                                                                                   │
    ├───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
    │┌──────┬─────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────┬──────┬─────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────┐│
    ││4 @ 0 │0 @ 4                                                                │1 @ 4                                                                │~~~~~ │6 @ 4                                                                │7 @ 4                                                                ││
    ││      │axis 5                                                               │axis 5                                                               │axis 5│axis 5                                                               │axis 5                                                               ││
    │├──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┤│
    ││0 @ 1 │ 2.217600000e+5  2.217610000e+5  ...  2.217670000e+5  2.217680000e+5 │ 2.217690000e+5  2.217700000e+5  ...  2.217760000e+5  2.217770000e+5 │ ...  │ 2.218140000e+5  2.218150000e+5  ...  2.218210000e+5  2.218220000e+5 │ 2.218230000e+5  2.218240000e+5  ...  2.218300000e+5  2.218310000e+5 ││
    ││axis 2│ 2.222640000e+5  2.222650000e+5  ...  2.222710000e+5  2.222720000e+5 │ 2.222730000e+5  2.222740000e+5  ...  2.222800000e+5  2.222810000e+5 │      │ 2.223180000e+5  2.223190000e+5  ...  2.223250000e+5  2.223260000e+5 │ 2.223270000e+5  2.223280000e+5  ...  2.223340000e+5  2.223350000e+5 ││
    ││      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            │      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            ││
    ││      │ 2.262960000e+5  2.262970000e+5  ...  2.263030000e+5  2.263040000e+5 │ 2.263050000e+5  2.263060000e+5  ...  2.263120000e+5  2.263130000e+5 │      │ 2.263500000e+5  2.263510000e+5  ...  2.263570000e+5  2.263580000e+5 │ 2.263590000e+5  2.263600000e+5  ...  2.263660000e+5  2.263670000e+5 ││
    ││      │ 2.268000000e+5  2.268010000e+5  ...  2.268070000e+5  2.268080000e+5 │ 2.268090000e+5  2.268100000e+5  ...  2.268160000e+5  2.268170000e+5 │      │ 2.268540000e+5  2.268550000e+5  ...  2.268610000e+5  2.268620000e+5 │ 2.268630000e+5  2.268640000e+5  ...  2.268700000e+5  2.268710000e+5 ││
    │├──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┤│
    ││1 @ 1 │ 2.273040000e+5  2.273050000e+5  ...  2.273110000e+5  2.273120000e+5 │ 2.273130000e+5  2.273140000e+5  ...  2.273200000e+5  2.273210000e+5 │ ...  │ 2.273580000e+5  2.273590000e+5  ...  2.273650000e+5  2.273660000e+5 │ 2.273670000e+5  2.273680000e+5  ...  2.273740000e+5  2.273750000e+5 ││
    ││axis 2│ 2.278080000e+5  2.278090000e+5  ...  2.278150000e+5  2.278160000e+5 │ 2.278170000e+5  2.278180000e+5  ...  2.278240000e+5  2.278250000e+5 │      │ 2.278620000e+5  2.278630000e+5  ...  2.278690000e+5  2.278700000e+5 │ 2.278710000e+5  2.278720000e+5  ...  2.278780000e+5  2.278790000e+5 ││
    ││      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            │      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            ││
    ││      │ 2.318400000e+5  2.318410000e+5  ...  2.318470000e+5  2.318480000e+5 │ 2.318490000e+5  2.318500000e+5  ...  2.318560000e+5  2.318570000e+5 │      │ 2.318940000e+5  2.318950000e+5  ...  2.319010000e+5  2.319020000e+5 │ 2.319030000e+5  2.319040000e+5  ...  2.319100000e+5  2.319110000e+5 ││
    ││      │ 2.323440000e+5  2.323450000e+5  ...  2.323510000e+5  2.323520000e+5 │ 2.323530000e+5  2.323540000e+5  ...  2.323600000e+5  2.323610000e+5 │      │ 2.323980000e+5  2.323990000e+5  ...  2.324050000e+5  2.324060000e+5 │ 2.324070000e+5  2.324080000e+5  ...  2.324140000e+5  2.324150000e+5 ││
    │├──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┤│
    ││~~~~~ │ ...                                                                 │ ...                                                                 │ ...  │ ...                                                                 │ ...                                                                 ││
    ││axis 2│                                                                     │                                                                     │      │                                                                     │                                                                     ││
    │├──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┤│
    ││8 @ 1 │ 2.661120000e+5  2.661130000e+5  ...  2.661190000e+5  2.661200000e+5 │ 2.661210000e+5  2.661220000e+5  ...  2.661280000e+5  2.661290000e+5 │ ...  │ 2.661660000e+5  2.661670000e+5  ...  2.661730000e+5  2.661740000e+5 │ 2.661750000e+5  2.661760000e+5  ...  2.661820000e+5  2.661830000e+5 ││
    ││axis 2│ 2.666160000e+5  2.666170000e+5  ...  2.666230000e+5  2.666240000e+5 │ 2.666250000e+5  2.666260000e+5  ...  2.666320000e+5  2.666330000e+5 │      │ 2.666700000e+5  2.666710000e+5  ...  2.666770000e+5  2.666780000e+5 │ 2.666790000e+5  2.666800000e+5  ...  2.666860000e+5  2.666870000e+5 ││
    ││      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            │      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            ││
    ││      │ 2.706480000e+5  2.706490000e+5  ...  2.706550000e+5  2.706560000e+5 │ 2.706570000e+5  2.706580000e+5  ...  2.706640000e+5  2.706650000e+5 │      │ 2.707020000e+5  2.707030000e+5  ...  2.707090000e+5  2.707100000e+5 │ 2.707110000e+5  2.707120000e+5  ...  2.707180000e+5  2.707190000e+5 ││
    ││      │ 2.711520000e+5  2.711530000e+5  ...  2.711590000e+5  2.711600000e+5 │ 2.711610000e+5  2.711620000e+5  ...  2.711680000e+5  2.711690000e+5 │      │ 2.712060000e+5  2.712070000e+5  ...  2.712130000e+5  2.712140000e+5 │ 2.712150000e+5  2.712160000e+5  ...  2.712220000e+5  2.712230000e+5 ││
    │├──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┤│
    ││9 @ 1 │ 2.716560000e+5  2.716570000e+5  ...  2.716630000e+5  2.716640000e+5 │ 2.716650000e+5  2.716660000e+5  ...  2.716720000e+5  2.716730000e+5 │ ...  │ 2.717100000e+5  2.717110000e+5  ...  2.717170000e+5  2.717180000e+5 │ 2.717190000e+5  2.717200000e+5  ...  2.717260000e+5  2.717270000e+5 ││
    ││axis 2│ 2.721600000e+5  2.721610000e+5  ...  2.721670000e+5  2.721680000e+5 │ 2.721690000e+5  2.721700000e+5  ...  2.721760000e+5  2.721770000e+5 │      │ 2.722140000e+5  2.722150000e+5  ...  2.722210000e+5  2.722220000e+5 │ 2.722230000e+5  2.722240000e+5  ...  2.722300000e+5  2.722310000e+5 ││
    ││      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            │      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            ││
    ││      │ 2.761920000e+5  2.761930000e+5  ...  2.761990000e+5  2.762000000e+5 │ 2.762010000e+5  2.762020000e+5  ...  2.762080000e+5  2.762090000e+5 │      │ 2.762460000e+5  2.762470000e+5  ...  2.762530000e+5  2.762540000e+5 │ 2.762550000e+5  2.762560000e+5  ...  2.762620000e+5  2.762630000e+5 ││
    ││      │ 2.766960000e+5  2.766970000e+5  ...  2.767030000e+5  2.767040000e+5 │ 2.767050000e+5  2.767060000e+5  ...  2.767120000e+5  2.767130000e+5 │      │ 2.767500000e+5  2.767510000e+5  ...  2.767570000e+5  2.767580000e+5 │ 2.767590000e+5  2.767600000e+5  ...  2.767660000e+5  2.767670000e+5 ││
    │└──────┴─────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────┴──────┴─────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────┘│
    ├───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
    │┌──────┬─────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────┬──────┬─────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────┐│
    ││5 @ 0 │0 @ 4                                                                │1 @ 4                                                                │~~~~~ │6 @ 4                                                                │7 @ 4                                                                ││
    ││      │axis 5                                                               │axis 5                                                               │axis 5│axis 5                                                               │axis 5                                                               ││
    │├──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┤│
    ││0 @ 1 │ 2.772000000e+5  2.772010000e+5  ...  2.772070000e+5  2.772080000e+5 │ 2.772090000e+5  2.772100000e+5  ...  2.772160000e+5  2.772170000e+5 │ ...  │ 2.772540000e+5  2.772550000e+5  ...  2.772610000e+5  2.772620000e+5 │ 2.772630000e+5  2.772640000e+5  ...  2.772700000e+5  2.772710000e+5 ││
    ││axis 2│ 2.777040000e+5  2.777050000e+5  ...  2.777110000e+5  2.777120000e+5 │ 2.777130000e+5  2.777140000e+5  ...  2.777200000e+5  2.777210000e+5 │      │ 2.777580000e+5  2.777590000e+5  ...  2.777650000e+5  2.777660000e+5 │ 2.777670000e+5  2.777680000e+5  ...  2.777740000e+5  2.777750000e+5 ││
    ││      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            │      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            ││
    ││      │ 2.817360000e+5  2.817370000e+5  ...  2.817430000e+5  2.817440000e+5 │ 2.817450000e+5  2.817460000e+5  ...  2.817520000e+5  2.817530000e+5 │      │ 2.817900000e+5  2.817910000e+5  ...  2.817970000e+5  2.817980000e+5 │ 2.817990000e+5  2.818000000e+5  ...  2.818060000e+5  2.818070000e+5 ││
    ││      │ 2.822400000e+5  2.822410000e+5  ...  2.822470000e+5  2.822480000e+5 │ 2.822490000e+5  2.822500000e+5  ...  2.822560000e+5  2.822570000e+5 │      │ 2.822940000e+5  2.822950000e+5  ...  2.823010000e+5  2.823020000e+5 │ 2.823030000e+5  2.823040000e+5  ...  2.823100000e+5  2.823110000e+5 ││
    │├──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┤│
    ││1 @ 1 │ 2.827440000e+5  2.827450000e+5  ...  2.827510000e+5  2.827520000e+5 │ 2.827530000e+5  2.827540000e+5  ...  2.827600000e+5  2.827610000e+5 │ ...  │ 2.827980000e+5  2.827990000e+5  ...  2.828050000e+5  2.828060000e+5 │ 2.828070000e+5  2.828080000e+5  ...  2.828140000e+5  2.828150000e+5 ││
    ││axis 2│ 2.832480000e+5  2.832490000e+5  ...  2.832550000e+5  2.832560000e+5 │ 2.832570000e+5  2.832580000e+5  ...  2.832640000e+5  2.832650000e+5 │      │ 2.833020000e+5  2.833030000e+5  ...  2.833090000e+5  2.833100000e+5 │ 2.833110000e+5  2.833120000e+5  ...  2.833180000e+5  2.833190000e+5 ││
    ││      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            │      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            ││
    ││      │ 2.872800000e+5  2.872810000e+5  ...  2.872870000e+5  2.872880000e+5 │ 2.872890000e+5  2.872900000e+5  ...  2.872960000e+5  2.872970000e+5 │      │ 2.873340000e+5  2.873350000e+5  ...  2.873410000e+5  2.873420000e+5 │ 2.873430000e+5  2.873440000e+5  ...  2.873500000e+5  2.873510000e+5 ││
    ││      │ 2.877840000e+5  2.877850000e+5  ...  2.877910000e+5  2.877920000e+5 │ 2.877930000e+5  2.877940000e+5  ...  2.878000000e+5  2.878010000e+5 │      │ 2.878380000e+5  2.878390000e+5  ...  2.878450000e+5  2.878460000e+5 │ 2.878470000e+5  2.878480000e+5  ...  2.878540000e+5  2.878550000e+5 ││
    │├──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┤│
    ││~~~~~ │ ...                                                                 │ ...                                                                 │ ...  │ ...                                                                 │ ...                                                                 ││
    ││axis 2│                                                                     │                                                                     │      │                                                                     │                                                                     ││
    │├──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┤│
    ││8 @ 1 │ 3.215520000e+5  3.215530000e+5  ...  3.215590000e+5  3.215600000e+5 │ 3.215610000e+5  3.215620000e+5  ...  3.215680000e+5  3.215690000e+5 │ ...  │ 3.216060000e+5  3.216070000e+5  ...  3.216130000e+5  3.216140000e+5 │ 3.216150000e+5  3.216160000e+5  ...  3.216220000e+5  3.216230000e+5 ││
    ││axis 2│ 3.220560000e+5  3.220570000e+5  ...  3.220630000e+5  3.220640000e+5 │ 3.220650000e+5  3.220660000e+5  ...  3.220720000e+5  3.220730000e+5 │      │ 3.221100000e+5  3.221110000e+5  ...  3.221170000e+5  3.221180000e+5 │ 3.221190000e+5  3.221200000e+5  ...  3.221260000e+5  3.221270000e+5 ││
    ││      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            │      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            ││
    ││      │ 3.260880000e+5  3.260890000e+5  ...  3.260950000e+5  3.260960000e+5 │ 3.260970000e+5  3.260980000e+5  ...  3.261040000e+5  3.261050000e+5 │      │ 3.261420000e+5  3.261430000e+5  ...  3.261490000e+5  3.261500000e+5 │ 3.261510000e+5  3.261520000e+5  ...  3.261580000e+5  3.261590000e+5 ││
    ││      │ 3.265920000e+5  3.265930000e+5  ...  3.265990000e+5  3.266000000e+5 │ 3.266010000e+5  3.266020000e+5  ...  3.266080000e+5  3.266090000e+5 │      │ 3.266460000e+5  3.266470000e+5  ...  3.266530000e+5  3.266540000e+5 │ 3.266550000e+5  3.266560000e+5  ...  3.266620000e+5  3.266630000e+5 ││
    │├──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┤│
    ││9 @ 1 │ 3.270960000e+5  3.270970000e+5  ...  3.271030000e+5  3.271040000e+5 │ 3.271050000e+5  3.271060000e+5  ...  3.271120000e+5  3.271130000e+5 │ ...  │ 3.271500000e+5  3.271510000e+5  ...  3.271570000e+5  3.271580000e+5 │ 3.271590000e+5  3.271600000e+5  ...  3.271660000e+5  3.271670000e+5 ││
    ││axis 2│ 3.276000000e+5  3.276010000e+5  ...  3.276070000e+5  3.276080000e+5 │ 3.276090000e+5  3.276100000e+5  ...  3.276160000e+5  3.276170000e+5 │      │ 3.276540000e+5  3.276550000e+5  ...  3.276610000e+5  3.276620000e+5 │ 3.276630000e+5  3.276640000e+5  ...  3.276700000e+5  3.276710000e+5 ││
    ││      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            │      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            ││
    ││      │ 3.316320000e+5  3.316330000e+5  ...  3.316390000e+5  3.316400000e+5 │ 3.316410000e+5  3.316420000e+5  ...  3.316480000e+5  3.316490000e+5 │      │ 3.316860000e+5  3.316870000e+5  ...  3.316930000e+5  3.316940000e+5 │ 3.316950000e+5  3.316960000e+5  ...  3.317020000e+5  3.317030000e+5 ││
    ││      │ 3.321360000e+5  3.321370000e+5  ...  3.321430000e+5  3.321440000e+5 │ 3.321450000e+5  3.321460000e+5  ...  3.321520000e+5  3.321530000e+5 │      │ 3.321900000e+5  3.321910000e+5  ...  3.321970000e+5  3.321980000e+5 │ 3.321990000e+5  3.322000000e+5  ...  3.322060000e+5  3.322070000e+5 ││
    │└──────┴─────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────┴──────┴─────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────┘│
    └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
    |}];
  Tensor.print ~with_code:false ~with_grad:false `Default hoo;
  (* Disable line wrapping for viewing the output. In VSCode: `View: Toggle Word Wrap`. *)
  [%expect
    {|
    ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
    │[6]: -_hoo shape 0:6|1:10,2:11                                                                                                                                                                                                                                                                         │
    │┌──────┬─────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────┬──────┬─────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────┐│
    ││      │0 @ 0                                                                │1 @ 0                                                                │~~~~~ │4 @ 0                                                                │5 @ 0                                                                ││
    ││      │axis 2                                                               │axis 2                                                               │axis 2│axis 2                                                               │axis 2                                                               ││
    │├──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┼──────┼─────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────┤│
    ││axis 1│ 2.535020000e+5  7.615340000e+5  ...  4.825790000e+6  5.333822000e+6 │ 5.613682400e+7  5.664485600e+7  ...  6.070908800e+7  6.121712000e+7 │ ...  │ 2.237871680e+8  2.242952160e+8  ...  2.283594400e+8  2.288674880e+8 │ 2.796706560e+8  2.801788160e+8  ...  2.842430080e+8  2.847510080e+8 ││
    ││      │ 5.841854000e+6  6.349886000e+6  ...  1.041414200e+7  1.092217400e+7 │ 6.172514400e+7  6.223317600e+7  ...  6.629741600e+7  6.680544800e+7 │      │ 2.293755040e+8  2.298835520e+8  ...  2.339478080e+8  2.344558240e+8 │ 2.852590400e+8  2.857671040e+8  ...  2.898312960e+8  2.903393920e+8 ││
    ││      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            │      │ ...             ...             ...  ...             ...            │ ...             ...             ...  ...             ...            ││
    ││      │ 4.496019200e+7  4.546822400e+7  ...  4.953244800e+7  5.004047200e+7 │ 1.008435120e+8  1.013515440e+8  ...  1.054157840e+8  1.059238160e+8 │      │ 2.684939840e+8  2.690020160e+8  ...  2.730663360e+8  2.735742400e+8 │ 3.243774720e+8  3.248855680e+8  ...  3.289498240e+8  3.294578240e+8 ││
    ││      │ 5.054850400e+7  5.105653600e+7  ...  5.512076800e+7  5.562879200e+7 │ 1.064318480e+8  1.069398800e+8  ...  1.110041360e+8  1.115121680e+8 │      │ 2.740823680e+8  2.745903360e+8  ...  2.786545600e+8  2.791626560e+8 │ 3.299658560e+8  3.304739200e+8  ...  3.345381120e+8  3.350462080e+8 ││
    │└──────┴─────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────┴──────┴─────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────┘│
    └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
    |}]
